<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>903aedd12ac24fd996c7f87cead605ba</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="cell code" data-execution_count="2170">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.statespace.sarimax <span class="im">import</span> SARIMAX</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression, LogisticRegression, Ridge</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, GridSearchCV</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score, log_loss, accuracy_score</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, StandardScaler, MinMaxScaler, LabelEncoder</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2171">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;/Users/mikeredshaw/Downloads/data_set_hackathon.csv&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2172">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2172">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>order_date</th>
      <th>requested_delivery_date</th>
      <th>Customer Country Code</th>
      <th>Product Code</th>
      <th>Description</th>
      <th>order_type</th>
      <th>Customer Order Code</th>
      <th>value</th>
      <th>Curr</th>
      <th>items</th>
      <th>Route</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13.07.2009</td>
      <td>28.01.2010</td>
      <td>RU</td>
      <td>L10705000</td>
      <td>Parka Outdoor Lifestyle STD</td>
      <td>VO</td>
      <td>3200435553</td>
      <td>2337.00</td>
      <td>RUB</td>
      <td>6</td>
      <td>RU0001</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15.07.2009</td>
      <td>24.03.2010</td>
      <td>RU</td>
      <td>L10705000</td>
      <td>Parka Outdoor Lifestyle STD</td>
      <td>VO</td>
      <td>3200435694</td>
      <td>10160.25</td>
      <td>RUB</td>
      <td>23</td>
      <td>RU0001</td>
    </tr>
    <tr>
      <th>2</th>
      <td>16.07.2009</td>
      <td>04.02.2010</td>
      <td>RU</td>
      <td>L10705000</td>
      <td>Parka Outdoor Lifestyle STD</td>
      <td>VO</td>
      <td>3200435741</td>
      <td>2992.50</td>
      <td>RUB</td>
      <td>7</td>
      <td>RU0001</td>
    </tr>
    <tr>
      <th>3</th>
      <td>17.07.2009</td>
      <td>04.02.2010</td>
      <td>RU</td>
      <td>L10705000</td>
      <td>Parka Outdoor Lifestyle STD</td>
      <td>VO</td>
      <td>3200435907</td>
      <td>4061.25</td>
      <td>RUB</td>
      <td>9</td>
      <td>RU0001</td>
    </tr>
    <tr>
      <th>4</th>
      <td>21.07.2009</td>
      <td>01.02.2010</td>
      <td>RU</td>
      <td>L10705000</td>
      <td>Parka Outdoor Lifestyle STD</td>
      <td>VO</td>
      <td>3200435963</td>
      <td>2208.75</td>
      <td>RUB</td>
      <td>5</td>
      <td>RU0001</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>Convert dates to datetime</p>
</div>
<div class="cell code" data-execution_count="2173">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2420 entries, 0 to 2419
Data columns (total 11 columns):
 #   Column                   Non-Null Count  Dtype  
---  ------                   --------------  -----  
 0   order_date               2420 non-null   object 
 1   requested_delivery_date  2420 non-null   object 
 2   Customer Country Code    2420 non-null   object 
 3   Product Code             2420 non-null   object 
 4   Description              2420 non-null   object 
 5   order_type               2420 non-null   object 
 6   Customer Order Code      2420 non-null   int64  
 7   value                    2420 non-null   float64
 8   Curr                     2420 non-null   object 
 9   items                    2420 non-null   object 
 10  Route                    2420 non-null   object 
dtypes: float64(1), int64(1), object(9)
memory usage: 208.1+ KB
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Removing nulls and \N from Data</p>
</div>
<div class="cell code" data-execution_count="2174">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df.replace(<span class="vs">r&#39;\N&#39;</span>, <span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Renaming columns</p>
</div>
<div class="cell code" data-execution_count="2175">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.rename(columns<span class="op">=</span>{<span class="st">&#39;order_date&#39;</span>: <span class="st">&#39;Order Date&#39;</span>, <span class="st">&#39;requested_delivery_date&#39;</span>: <span class="st">&#39;Requested Delivery Date&#39;</span>, <span class="st">&#39;order_type&#39;</span>: <span class="st">&#39;Order Type&#39;</span>, <span class="st">&#39;value&#39;</span>: <span class="st">&#39;Value&#39;</span>, <span class="st">&#39;Curr&#39;</span>: <span class="st">&#39;Currency&#39;</span>, <span class="st">&#39;items&#39;</span>: <span class="st">&#39;Items&#39;</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Removing negative Lead Day values</p>
</div>
<div class="cell code" data-execution_count="2176">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>negative_rows <span class="op">=</span> df[df[<span class="st">&#39;Value&#39;</span>] <span class="op">&lt;</span> <span class="dv">0</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(negative_rows)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>     Order Date Requested Delivery Date Customer Country Code Product Code  \
929  28.02.2011              15.09.2011                    CH    L12136100   

                     Description Order Type  Customer Order Code  Value  \
929  Parka Outdoor Lifestyle STD         VO           3200633089  -0.03   

    Currency Items   Route  
929      CHF     0  CH0001  
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2177">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">&#39;Value&#39;</span>] <span class="op">&gt;=</span> <span class="dv">0</span>]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2178">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Order Date&#39;</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">&#39;Order Date&#39;</span>], <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%d</span><span class="st">.%m.%Y&#39;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Requested Delivery Date&#39;</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">&#39;Requested Delivery Date&#39;</span>], <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%d</span><span class="st">.%m.%Y&#39;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Order Year&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Order Date&#39;</span>].dt.year</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Order Month&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Order Date&#39;</span>].dt.month</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Delivery Year&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Requested Delivery Date&#39;</span>].dt.year</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Delivery Month&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Requested Delivery Date&#39;</span>].dt.month</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2179">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code></pre></div>
<div class="output execute_result" data-execution_count="2179">
<pre><code>Order Date                 datetime64[ns]
Requested Delivery Date    datetime64[ns]
Customer Country Code              object
Product Code                       object
Description                        object
Order Type                         object
Customer Order Code                 int64
Value                             float64
Currency                           object
Items                              object
Route                              object
Order Year                          int64
Order Month                         int64
Delivery Year                       int64
Delivery Month                      int64
dtype: object</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2180">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Order Year&#39;</span>].unique()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2180">
<pre><code>array([2009, 2010, 2011, 2012])</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2181">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Delivery Year&#39;</span>].unique()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2181">
<pre><code>array([2010, 2011, 2012, 2013])</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2182">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Items&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Items&#39;</span>].astype(<span class="bu">int</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Review orders on a monthly level.</p>
</div>
<div class="cell code" data-execution_count="2183">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>monthly_orders <span class="op">=</span> df.groupby([<span class="st">&#39;Order Year&#39;</span>, <span class="st">&#39;Order Month&#39;</span>]).agg({<span class="st">&#39;Value&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;Items&#39;</span>: <span class="st">&#39;sum&#39;</span>}).reset_index()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>monthly_orders <span class="op">=</span> monthly_orders.sort_values(by<span class="op">=</span>[<span class="st">&#39;Order Year&#39;</span>, <span class="st">&#39;Order Month&#39;</span>])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2184">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>monthly_orders <span class="op">=</span> monthly_orders.sort_values(by<span class="op">=</span>[<span class="st">&#39;Order Year&#39;</span>, <span class="st">&#39;Order Month&#39;</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>monthly_orders.head(<span class="dv">30</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="2184">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order Year</th>
      <th>Order Month</th>
      <th>Value</th>
      <th>Items</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2009</td>
      <td>7</td>
      <td>462065.60</td>
      <td>1067</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009</td>
      <td>8</td>
      <td>45673.86</td>
      <td>137</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2009</td>
      <td>9</td>
      <td>1692.29</td>
      <td>70</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2009</td>
      <td>10</td>
      <td>97.42</td>
      <td>10</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2009</td>
      <td>11</td>
      <td>12492.89</td>
      <td>630</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2009</td>
      <td>12</td>
      <td>159934.26</td>
      <td>361</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2010</td>
      <td>1</td>
      <td>20266.37</td>
      <td>187</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2010</td>
      <td>2</td>
      <td>74925.83</td>
      <td>370</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2010</td>
      <td>3</td>
      <td>14282.48</td>
      <td>314</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2010</td>
      <td>4</td>
      <td>804.00</td>
      <td>81</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2010</td>
      <td>5</td>
      <td>70.16</td>
      <td>7</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2010</td>
      <td>6</td>
      <td>68.55</td>
      <td>3</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2010</td>
      <td>12</td>
      <td>305310.94</td>
      <td>705</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2011</td>
      <td>1</td>
      <td>28809.93</td>
      <td>1750</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2011</td>
      <td>2</td>
      <td>36957.84</td>
      <td>871</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2011</td>
      <td>3</td>
      <td>32875.97</td>
      <td>270</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2011</td>
      <td>4</td>
      <td>8456.14</td>
      <td>47</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2011</td>
      <td>5</td>
      <td>2874.31</td>
      <td>14</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2011</td>
      <td>6</td>
      <td>981.28</td>
      <td>45</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2011</td>
      <td>7</td>
      <td>1325577.05</td>
      <td>6616</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2011</td>
      <td>8</td>
      <td>226406.43</td>
      <td>2408</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2011</td>
      <td>9</td>
      <td>33699.17</td>
      <td>983</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2011</td>
      <td>10</td>
      <td>750.38</td>
      <td>62</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2011</td>
      <td>11</td>
      <td>556.80</td>
      <td>57</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2012</td>
      <td>1</td>
      <td>17568.60</td>
      <td>42</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2012</td>
      <td>4</td>
      <td>49.91</td>
      <td>7</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2012</td>
      <td>11</td>
      <td>1155.00</td>
      <td>77</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="2185">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>monthly_orders[<span class="st">&#39;Order Year Month&#39;</span>] <span class="op">=</span> monthly_orders[<span class="st">&#39;Order Year&#39;</span>].astype(<span class="bu">str</span>) <span class="op">+</span><span class="st">&quot;-&quot;</span> <span class="op">+</span> monthly_orders[<span class="st">&#39;Order Month&#39;</span>].astype(<span class="bu">str</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>monthly_orders, x<span class="op">=</span><span class="st">&#39;Order Year Month&#39;</span>, y<span class="op">=</span><span class="st">&#39;Value&#39;</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Order Year Month&#39;</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Value&#39;</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Sum of Value over Order Year Month&#39;</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>monthly_orders, x<span class="op">=</span><span class="st">&#39;Order Year Month&#39;</span>, y<span class="op">=</span><span class="st">&#39;Items&#39;</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Order Year Month&#39;</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Items&#39;</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Sum of Items over Order Year Month&#39;</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_9c521f475cad414ea18971055c4e8e19/81cec84d90dc7efd923363af177354053a61a220.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="2186">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>monthly_orders[<span class="st">&#39;Order Year Month&#39;</span>].unique()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2186">
<pre><code>array([&#39;2009-7&#39;, &#39;2009-8&#39;, &#39;2009-9&#39;, &#39;2009-10&#39;, &#39;2009-11&#39;, &#39;2009-12&#39;,
       &#39;2010-1&#39;, &#39;2010-2&#39;, &#39;2010-3&#39;, &#39;2010-4&#39;, &#39;2010-5&#39;, &#39;2010-6&#39;,
       &#39;2010-12&#39;, &#39;2011-1&#39;, &#39;2011-2&#39;, &#39;2011-3&#39;, &#39;2011-4&#39;, &#39;2011-5&#39;,
       &#39;2011-6&#39;, &#39;2011-7&#39;, &#39;2011-8&#39;, &#39;2011-9&#39;, &#39;2011-10&#39;, &#39;2011-11&#39;,
       &#39;2012-1&#39;, &#39;2012-4&#39;, &#39;2012-11&#39;], dtype=object)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2187">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>monthly_orders.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2187">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order Year</th>
      <th>Order Month</th>
      <th>Value</th>
      <th>Items</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>27.000000</td>
      <td>27.000000</td>
      <td>2.700000e+01</td>
      <td>27.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2010.407407</td>
      <td>6.370370</td>
      <td>1.042372e+05</td>
      <td>636.703704</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.971092</td>
      <td>3.628394</td>
      <td>2.675117e+05</td>
      <td>1329.654808</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2009.000000</td>
      <td>1.000000</td>
      <td>4.991000e+01</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2010.000000</td>
      <td>3.500000</td>
      <td>8.926400e+02</td>
      <td>46.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2011.000000</td>
      <td>6.000000</td>
      <td>1.428248e+04</td>
      <td>137.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2011.000000</td>
      <td>9.500000</td>
      <td>4.131585e+04</td>
      <td>667.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2012.000000</td>
      <td>12.000000</td>
      <td>1.325577e+06</td>
      <td>6616.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="2188">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>monthly_orders.plot(x<span class="op">=</span><span class="st">&#39;Order Year Month&#39;</span>, y<span class="op">=</span><span class="st">&#39;Items&#39;</span>, kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Order Year Month&#39;</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Number of Items&#39;</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Number of Items per Order Year Month&#39;</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_9c521f475cad414ea18971055c4e8e19/0d8dc6fa32af00b313f81a3c0a0358b63c182d53.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="2189">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>monthly_orders, x<span class="op">=</span><span class="st">&#39;Items&#39;</span>, bins<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Items&#39;</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Histogram of Items&#39;</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_9c521f475cad414ea18971055c4e8e19/6d5bf8675dd8132341c169c63d1834446e9ede3c.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Review orders on a seasonal basis.</p>
</div>
<div class="cell code" data-execution_count="2190">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> month_to_season(month):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> month <span class="kw">in</span> [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]:</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Spring&#39;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> month <span class="kw">in</span> [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>]:</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Summer&#39;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> month <span class="kw">in</span> [<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>]:</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Fall&#39;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Winter&#39;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;O_Season&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Order Month&#39;</span>].<span class="bu">apply</span>(month_to_season)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;D_Season&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Delivery Month&#39;</span>].<span class="bu">apply</span>(month_to_season)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;O_Season_Num&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;O_Season&#39;</span>].<span class="bu">map</span>({<span class="st">&#39;Winter&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;Spring&#39;</span>: <span class="dv">2</span>, <span class="st">&#39;Summer&#39;</span>: <span class="dv">3</span>, <span class="st">&#39;Fall&#39;</span>: <span class="dv">4</span>})</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;D_Season_Num&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;D_Season&#39;</span>].<span class="bu">map</span>({<span class="st">&#39;Winter&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;Spring&#39;</span>: <span class="dv">2</span>, <span class="st">&#39;Summer&#39;</span>: <span class="dv">3</span>, <span class="st">&#39;Fall&#39;</span>: <span class="dv">4</span>})</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Year-Season&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Order Year&#39;</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">&#39;-&#39;</span> <span class="op">+</span> df[<span class="st">&#39;O_Season_Num&#39;</span>].astype(<span class="bu">str</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>year_season_orders <span class="op">=</span> df.groupby(<span class="st">&#39;Year-Season&#39;</span>).agg({<span class="st">&#39;Value&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;Items&#39;</span>: <span class="st">&#39;sum&#39;</span>}).reset_index()</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>year_season_orders[<span class="st">&#39;Year-Season&#39;</span>] <span class="op">=</span> pd.Categorical(year_season_orders[<span class="st">&#39;Year-Season&#39;</span>], categories<span class="op">=</span><span class="bu">sorted</span>(df[<span class="st">&#39;Year-Season&#39;</span>].unique()), ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>year_season_orders <span class="op">=</span> year_season_orders.sort_values(<span class="st">&#39;Year-Season&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2191">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>year_season_orders <span class="op">=</span> year_season_orders.sort_values(<span class="st">&#39;Year-Season&#39;</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>year_season_orders, x<span class="op">=</span><span class="st">&#39;Year-Season&#39;</span>, y<span class="op">=</span><span class="st">&#39;Value&#39;</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Year-Season&#39;</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Value&#39;</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Sum of Value over Year-Season&#39;</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>year_season_orders, x<span class="op">=</span><span class="st">&#39;Year-Season&#39;</span>, y<span class="op">=</span><span class="st">&#39;Items&#39;</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Year-Season&#39;</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Items&#39;</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Sum of Items over Year-Season&#39;</span>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_9c521f475cad414ea18971055c4e8e19/a82f33fe0e77f35705af79064823466294fb12b5.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="2192">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Grouped_D_Season <span class="op">=</span> df.groupby([<span class="st">&#39;Delivery Year&#39;</span>, <span class="st">&#39;D_Season_Num&#39;</span>]).agg({<span class="st">&#39;Value&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;Items&#39;</span>: <span class="st">&#39;sum&#39;</span>}).reset_index()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>Grouped_D_Season[<span class="st">&#39;Delivery Year Season&#39;</span>] <span class="op">=</span> Grouped_D_Season[<span class="st">&#39;Delivery Year&#39;</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">&#39;-&#39;</span> <span class="op">+</span> Grouped_D_Season[<span class="st">&#39;D_Season_Num&#39;</span>].astype(<span class="bu">str</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2193">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>Grouped_D_Season.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2193">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Delivery Year</th>
      <th>D_Season_Num</th>
      <th>Value</th>
      <th>Items</th>
      <th>Delivery Year Season</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2010</td>
      <td>1</td>
      <td>480163.07</td>
      <td>1120</td>
      <td>2010-1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2010</td>
      <td>2</td>
      <td>37124.60</td>
      <td>164</td>
      <td>2010-2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2010</td>
      <td>3</td>
      <td>67007.98</td>
      <td>1059</td>
      <td>2010-3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2010</td>
      <td>4</td>
      <td>208078.06</td>
      <td>894</td>
      <td>2010-4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011</td>
      <td>1</td>
      <td>20612.00</td>
      <td>65</td>
      <td>2011-1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="2194">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>Grouped_D_Season, x<span class="op">=</span><span class="st">&#39;Delivery Year Season&#39;</span>, y<span class="op">=</span><span class="st">&#39;Value&#39;</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Delivery Year Season&#39;</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Value&#39;</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Sum of Value over Delivery Year Season&#39;</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>Grouped_D_Season, x<span class="op">=</span><span class="st">&#39;Delivery Year Season&#39;</span>, y<span class="op">=</span><span class="st">&#39;Items&#39;</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Delivery Year Season&#39;</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Items&#39;</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Sum of Items over Delivery Year Season&#39;</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_9c521f475cad414ea18971055c4e8e19/9d19604c21655e56c540477efa45436b6448a40d.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Calculate Lead Time in days &amp; months, value per item,
Customer_ID, give season a numerical value.</p>
</div>
<div class="cell code" data-execution_count="2195">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Lead_Time_Days&#39;</span>] <span class="op">=</span> (df[<span class="st">&#39;Requested Delivery Date&#39;</span>] <span class="op">-</span> df[<span class="st">&#39;Order Date&#39;</span>]).dt.days</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Lead_Time_Months&#39;</span>] <span class="op">=</span> (df[<span class="st">&#39;Delivery Year&#39;</span>] <span class="op">-</span> df[<span class="st">&#39;Order Year&#39;</span>]) <span class="op">*</span> <span class="dv">12</span> <span class="op">+</span> (df[<span class="st">&#39;Delivery Month&#39;</span>] <span class="op">-</span> df[<span class="st">&#39;Order Month&#39;</span>])</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Value/Item&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Value&#39;</span>] <span class="op">/</span> df[<span class="st">&#39;Items&#39;</span>]</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Customer_ID&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Customer Country Code&#39;</span>] <span class="op">+</span> <span class="st">&#39;-&#39;</span> <span class="op">+</span> df[<span class="st">&#39;Route&#39;</span>]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2196">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>negative_lead_time <span class="op">=</span> df[df[<span class="st">&#39;Lead_Time_Days&#39;</span>] <span class="op">&lt;</span> <span class="dv">0</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(negative_lead_time)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">&#39;Lead_Time_Days&#39;</span>] <span class="op">&gt;=</span> <span class="dv">0</span>]</span></code></pre></div>
<div class="output stream stdout">
<pre><code>    Order Date Requested Delivery Date Customer Country Code Product Code  \
477 2012-11-19              2012-11-16                    FR    L12134400   
523 2012-11-19              2012-11-16                    FR    L12134500   
583 2012-11-19              2012-11-16                    FR    L12134600   
742 2012-11-19              2012-11-16                    FR    L12135800   

                     Description Order Type  Customer Order Code  Value  \
477  Parka Outdoor Lifestyle STD         VO           3201061588  120.0   
523  Parka Outdoor Lifestyle STD         VO           3201061588  525.0   
583  Parka Outdoor Lifestyle STD         VO           3201061588   15.0   
742  Parka Outdoor Lifestyle STD         VO           3201061588  495.0   

    Currency  Items  ... Delivery Month  O_Season  D_Season  O_Season_Num  \
477      EUR      8  ...             11      Fall      Fall             4   
523      EUR     35  ...             11      Fall      Fall             4   
583      EUR      1  ...             11      Fall      Fall             4   
742      EUR     33  ...             11      Fall      Fall             4   

     D_Season_Num Year-Season Lead_Time_Days  Lead_Time_Months  Value/Item  \
477             4      2012-4             -3                 0        15.0   
523             4      2012-4             -3                 0        15.0   
583             4      2012-4             -3                 0        15.0   
742             4      2012-4             -3                 0        15.0   

    Customer_ID  
477   FR-FR0001  
523   FR-FR0001  
583   FR-FR0001  
742   FR-FR0001  

[4 rows x 24 columns]
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2197">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Lead_Time_Days&#39;</span>].describe(include<span class="op">=</span><span class="st">&#39;all&#39;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="2197">
<pre><code>count    2415.000000
mean      221.617391
std        52.510166
min        15.000000
25%       196.000000
50%       217.000000
75%       251.000000
max       459.000000
Name: Lead_Time_Days, dtype: float64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2198">
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">&#39;Lead_Time_Days&#39;</span>, bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Items&#39;</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Histogram of Items&#39;</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_9c521f475cad414ea18971055c4e8e19/a56106f9bb04a2992a1658ce3049f47872934d15.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="2199">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>product_dummies <span class="op">=</span> pd.get_dummies(df[<span class="st">&#39;Product Code&#39;</span>])</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([df, product_dummies], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;advanced_order&#39;</span>] <span class="op">=</span> (df[<span class="st">&#39;Lead_Time_Days&#39;</span>] <span class="op">&gt;=</span> <span class="dv">30</span>).astype(<span class="bu">int</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;advanced_order_amount&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Items&#39;</span>] <span class="op">*</span> df[<span class="st">&#39;advanced_order&#39;</span>]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;urgent_order_amount&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Items&#39;</span>] <span class="op">-</span> df[<span class="st">&#39;advanced_order_amount&#39;</span>]</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Make Average Selection rate of product per season:</p>
</div>
<div class="cell code" data-execution_count="2200">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>total_items_per_season <span class="op">=</span> df.groupby(<span class="st">&#39;O_Season_Num&#39;</span>)[<span class="st">&#39;Items&#39;</span>].<span class="bu">sum</span>()</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>items_per_product_season <span class="op">=</span> df.groupby([<span class="st">&#39;O_Season_Num&#39;</span>, <span class="st">&#39;Product Code&#39;</span>])[<span class="st">&#39;Items&#39;</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.merge(items_per_product_season, total_items_per_season, on<span class="op">=</span><span class="st">&#39;O_Season_Num&#39;</span>, suffixes<span class="op">=</span>(<span class="st">&#39;&#39;</span>, <span class="st">&#39;_Total&#39;</span>))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>merged_df[<span class="st">&#39;Selection_Rate&#39;</span>] <span class="op">=</span> merged_df[<span class="st">&#39;Items&#39;</span>] <span class="op">/</span> merged_df[<span class="st">&#39;Items_Total&#39;</span>]</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>selection_rate_dict <span class="op">=</span> merged_df.set_index([<span class="st">&#39;O_Season_Num&#39;</span>, <span class="st">&#39;Product Code&#39;</span>])[<span class="st">&#39;Selection_Rate&#39;</span>].to_dict()</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Avg_Season_Selection_Rate&#39;</span>] <span class="op">=</span> df.<span class="bu">apply</span>(<span class="kw">lambda</span> row: selection_rate_dict.get((row[<span class="st">&#39;O_Season_Num&#39;</span>], row[<span class="st">&#39;Product Code&#39;</span>])), axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Let's see how many variations in lead time months there are to
determine how to categorize if an order is urgent, Advanced &amp;
Urgent, or Simply Advanced.</p>
</div>
<div class="cell code" data-execution_count="2201">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Lead_Time_Months&#39;</span>].unique()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2201">
<pre><code>array([ 6,  8,  7, 10,  9,  5,  4,  3, 12, 11,  2,  0,  1, 15])</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Set "Order Urgency" labels</p>
<p>Urgent is due to be delivered within 30 days. Advanced Urgent is
within 30 and 60 days. Advanced is 60+ days lead time.</p>
</div>
<div class="cell code" data-execution_count="2202">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Urgent&#39;</span>] <span class="op">=</span> (df[<span class="st">&#39;Lead_Time_Days&#39;</span>] <span class="op">&lt;</span> <span class="dv">30</span>).astype(<span class="bu">int</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Advanced_Urgent&#39;</span>] <span class="op">=</span> ((df[<span class="st">&#39;Lead_Time_Days&#39;</span>] <span class="op">&gt;=</span> <span class="dv">30</span>) <span class="op">&amp;</span> (df[<span class="st">&#39;Lead_Time_Days&#39;</span>] <span class="op">&lt;=</span> <span class="dv">60</span>)).astype(<span class="bu">int</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Advanced&#39;</span>] <span class="op">=</span> (df[<span class="st">&#39;Lead_Time_Days&#39;</span>] <span class="op">&gt;</span> <span class="dv">60</span>).astype(<span class="bu">int</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell markdown">
<p>Now for each row, determine the number of items orders for each level
of "order urgency"</p>
</div>
<div class="cell code" data-execution_count="2203">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Urgent Items&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Urgent&#39;</span>] <span class="op">*</span> df[<span class="st">&#39;Items&#39;</span>]</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Advanced_Urgent_Items&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Advanced_Urgent&#39;</span>] <span class="op">*</span> df[<span class="st">&#39;Items&#39;</span>]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Advanced_Items&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Advanced&#39;</span>] <span class="op">*</span> df[<span class="st">&#39;Items&#39;</span>]</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Lets save a copy of this DF, but clean the one we'll be using up a
little bit.</p>
</div>
<div class="cell code" data-execution_count="2204">
<div class="sourceCode" id="cb44"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.copy()</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2205">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code></pre></div>
<div class="output execute_result" data-execution_count="2205">
<pre><code>Index([&#39;Order Date&#39;, &#39;Requested Delivery Date&#39;, &#39;Customer Country Code&#39;,
       &#39;Product Code&#39;, &#39;Description&#39;, &#39;Order Type&#39;, &#39;Customer Order Code&#39;,
       &#39;Value&#39;, &#39;Currency&#39;, &#39;Items&#39;, &#39;Route&#39;, &#39;Order Year&#39;, &#39;Order Month&#39;,
       &#39;Delivery Year&#39;, &#39;Delivery Month&#39;, &#39;O_Season&#39;, &#39;D_Season&#39;,
       &#39;O_Season_Num&#39;, &#39;D_Season_Num&#39;, &#39;Year-Season&#39;, &#39;Lead_Time_Days&#39;,
       &#39;Lead_Time_Months&#39;, &#39;Value/Item&#39;, &#39;Customer_ID&#39;, &#39;L10705000&#39;,
       &#39;L10705100&#39;, &#39;L10705200&#39;, &#39;L10705300&#39;, &#39;L10705400&#39;, &#39;L10705500&#39;,
       &#39;L10705600&#39;, &#39;L10705700&#39;, &#39;L10850600&#39;, &#39;L10850700&#39;, &#39;L10850800&#39;,
       &#39;L10850900&#39;, &#39;L10852800&#39;, &#39;L10852900&#39;, &#39;L10853100&#39;, &#39;L12134400&#39;,
       &#39;L12134500&#39;, &#39;L12134600&#39;, &#39;L12134700&#39;, &#39;L12135800&#39;, &#39;L12135900&#39;,
       &#39;L12136000&#39;, &#39;L12136100&#39;, &#39;L12916800&#39;, &#39;L12916900&#39;, &#39;L12917000&#39;,
       &#39;L12917100&#39;, &#39;L12917700&#39;, &#39;L12917800&#39;, &#39;L12917900&#39;, &#39;L12918000&#39;,
       &#39;L12918400&#39;, &#39;L12918500&#39;, &#39;L12918600&#39;, &#39;L12918700&#39;, &#39;L12918800&#39;,
       &#39;L12918900&#39;, &#39;L12919000&#39;, &#39;L12919100&#39;, &#39;L12919200&#39;, &#39;advanced_order&#39;,
       &#39;advanced_order_amount&#39;, &#39;urgent_order_amount&#39;,
       &#39;Avg_Season_Selection_Rate&#39;, &#39;Urgent&#39;, &#39;Advanced_Urgent&#39;, &#39;Advanced&#39;,
       &#39;Urgent Items&#39;, &#39;Advanced_Urgent_Items&#39;, &#39;Advanced_Items&#39;],
      dtype=&#39;object&#39;)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2206">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df.drop([<span class="st">&#39;Description&#39;</span>, <span class="st">&#39;Order Type&#39;</span>, <span class="st">&#39;Currency&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Reordering columns in the DataFrame to make them make more sense</p>
</div>
<div class="cell code" data-execution_count="2207">
<div class="sourceCode" id="cb48"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[[</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Customer Order Code&#39;</span>, <span class="st">&#39;Customer_ID&#39;</span>, <span class="st">&#39;Order Date&#39;</span>, <span class="st">&#39;Order Year&#39;</span>, <span class="st">&#39;Order Month&#39;</span>,<span class="st">&#39;O_Season&#39;</span>, <span class="st">&#39;O_Season_Num&#39;</span>,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Requested Delivery Date&#39;</span>, <span class="st">&#39;Delivery Year&#39;</span>, <span class="st">&#39;Delivery Month&#39;</span>, <span class="st">&#39;D_Season&#39;</span>, <span class="st">&#39;D_Season_Num&#39;</span>, <span class="st">&#39;Year-Season&#39;</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Lead_Time_Days&#39;</span>, <span class="st">&#39;Lead_Time_Months&#39;</span>, <span class="st">&#39;Items&#39;</span>, <span class="st">&#39;Value&#39;</span>, <span class="st">&#39;Value/Item&#39;</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Route&#39;</span>, <span class="st">&#39;Product Code&#39;</span>, <span class="st">&#39;Customer Country Code&#39;</span>, <span class="st">&#39;advanced_order&#39;</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;advanced_order_amount&#39;</span>, <span class="st">&#39;urgent_order_amount&#39;</span>, <span class="st">&#39;Urgent&#39;</span>, <span class="st">&#39;Advanced_Urgent&#39;</span>, <span class="st">&#39;Advanced&#39;</span>,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Urgent Items&#39;</span>, <span class="st">&#39;Advanced_Urgent_Items&#39;</span>, <span class="st">&#39;Advanced_Items&#39;</span>, <span class="st">&#39;Avg_Season_Selection_Rate&#39;</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>]]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2208">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2208">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Customer Order Code</th>
      <th>Customer_ID</th>
      <th>Order Date</th>
      <th>Order Year</th>
      <th>Order Month</th>
      <th>O_Season</th>
      <th>O_Season_Num</th>
      <th>Requested Delivery Date</th>
      <th>Delivery Year</th>
      <th>Delivery Month</th>
      <th>...</th>
      <th>advanced_order</th>
      <th>advanced_order_amount</th>
      <th>urgent_order_amount</th>
      <th>Urgent</th>
      <th>Advanced_Urgent</th>
      <th>Advanced</th>
      <th>Urgent Items</th>
      <th>Advanced_Urgent_Items</th>
      <th>Advanced_Items</th>
      <th>Avg_Season_Selection_Rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3200435553</td>
      <td>RU-RU0001</td>
      <td>2009-07-13</td>
      <td>2009</td>
      <td>7</td>
      <td>Summer</td>
      <td>3</td>
      <td>2010-01-28</td>
      <td>2010</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>0.017517</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3200435694</td>
      <td>RU-RU0001</td>
      <td>2009-07-15</td>
      <td>2009</td>
      <td>7</td>
      <td>Summer</td>
      <td>3</td>
      <td>2010-03-24</td>
      <td>2010</td>
      <td>3</td>
      <td>...</td>
      <td>1</td>
      <td>23</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>23</td>
      <td>0.017517</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3200435741</td>
      <td>RU-RU0001</td>
      <td>2009-07-16</td>
      <td>2009</td>
      <td>7</td>
      <td>Summer</td>
      <td>3</td>
      <td>2010-02-04</td>
      <td>2010</td>
      <td>2</td>
      <td>...</td>
      <td>1</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>7</td>
      <td>0.017517</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3200435907</td>
      <td>RU-RU0001</td>
      <td>2009-07-17</td>
      <td>2009</td>
      <td>7</td>
      <td>Summer</td>
      <td>3</td>
      <td>2010-02-04</td>
      <td>2010</td>
      <td>2</td>
      <td>...</td>
      <td>1</td>
      <td>9</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>0.017517</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3200435963</td>
      <td>RU-RU0001</td>
      <td>2009-07-21</td>
      <td>2009</td>
      <td>7</td>
      <td>Summer</td>
      <td>3</td>
      <td>2010-02-01</td>
      <td>2010</td>
      <td>2</td>
      <td>...</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>0.017517</td>
    </tr>
  </tbody>
</table>
<p>5 rows  31 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="2209">
<div class="sourceCode" id="cb50"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df_month_lead <span class="op">=</span> df.groupby([<span class="st">&#39;Order Year&#39;</span>, <span class="st">&#39;Order Month&#39;</span>]).agg({<span class="st">&#39;O_Season_Num&#39;</span>:<span class="st">&#39;max&#39;</span>, <span class="st">&#39;Items&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;Urgent Items&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;Advanced_Urgent_Items&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;Advanced_Items&#39;</span>: <span class="st">&#39;sum&#39;</span>}).reset_index()</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2210">
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df_month_lead.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2210">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order Year</th>
      <th>Order Month</th>
      <th>O_Season_Num</th>
      <th>Items</th>
      <th>Urgent Items</th>
      <th>Advanced_Urgent_Items</th>
      <th>Advanced_Items</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2009</td>
      <td>7</td>
      <td>3</td>
      <td>1067</td>
      <td>0</td>
      <td>0</td>
      <td>1067</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009</td>
      <td>8</td>
      <td>3</td>
      <td>137</td>
      <td>0</td>
      <td>0</td>
      <td>137</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2009</td>
      <td>9</td>
      <td>4</td>
      <td>70</td>
      <td>0</td>
      <td>0</td>
      <td>70</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2009</td>
      <td>10</td>
      <td>4</td>
      <td>10</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2009</td>
      <td>11</td>
      <td>4</td>
      <td>630</td>
      <td>0</td>
      <td>0</td>
      <td>630</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="2211">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df_demand_delivery <span class="op">=</span> df.groupby([ <span class="st">&#39;Delivery Year&#39;</span>, <span class="st">&#39;Delivery Month&#39;</span>]).agg({<span class="st">&#39;D_Season_Num&#39;</span>:<span class="st">&#39;max&#39;</span>, <span class="st">&#39;Items&#39;</span>: <span class="st">&#39;sum&#39;</span>}).reset_index()</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2212">
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df_demand_delivery <span class="op">=</span> df_demand_delivery.sort_values(by<span class="op">=</span>[<span class="st">&#39;Delivery Year&#39;</span>, <span class="st">&#39;Delivery Month&#39;</span>])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2213">
<div class="sourceCode" id="cb54"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df_demand_delivery</span></code></pre></div>
<div class="output execute_result" data-execution_count="2213">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Delivery Year</th>
      <th>Delivery Month</th>
      <th>D_Season_Num</th>
      <th>Items</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2010</td>
      <td>1</td>
      <td>1</td>
      <td>338</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2010</td>
      <td>2</td>
      <td>1</td>
      <td>755</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2010</td>
      <td>3</td>
      <td>2</td>
      <td>134</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2010</td>
      <td>4</td>
      <td>2</td>
      <td>21</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2010</td>
      <td>5</td>
      <td>2</td>
      <td>9</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2010</td>
      <td>6</td>
      <td>3</td>
      <td>54</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2010</td>
      <td>7</td>
      <td>3</td>
      <td>750</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2010</td>
      <td>8</td>
      <td>3</td>
      <td>255</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2010</td>
      <td>9</td>
      <td>4</td>
      <td>663</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2010</td>
      <td>10</td>
      <td>4</td>
      <td>150</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2010</td>
      <td>11</td>
      <td>4</td>
      <td>81</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2010</td>
      <td>12</td>
      <td>1</td>
      <td>27</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2011</td>
      <td>7</td>
      <td>3</td>
      <td>34</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2011</td>
      <td>8</td>
      <td>3</td>
      <td>1836</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2011</td>
      <td>9</td>
      <td>4</td>
      <td>1405</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2011</td>
      <td>10</td>
      <td>4</td>
      <td>465</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2011</td>
      <td>11</td>
      <td>4</td>
      <td>211</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2011</td>
      <td>12</td>
      <td>1</td>
      <td>65</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2012</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2012</td>
      <td>2</td>
      <td>1</td>
      <td>2925</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2012</td>
      <td>3</td>
      <td>2</td>
      <td>2837</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2012</td>
      <td>4</td>
      <td>2</td>
      <td>2683</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2012</td>
      <td>5</td>
      <td>2</td>
      <td>1204</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2012</td>
      <td>6</td>
      <td>3</td>
      <td>201</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2012</td>
      <td>7</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2012</td>
      <td>10</td>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2013</td>
      <td>4</td>
      <td>2</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p><strong>I will now predict the choice probabilities of each product
getting selected for an order</strong></p>
</div>
<div class="cell markdown">
<p>Per row calculation (no aggregation)</p>
</div>
<div class="cell code" data-execution_count="2214">
<div class="sourceCode" id="cb55"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2215">
<div class="sourceCode" id="cb56"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [<span class="st">&#39;O_Season_Num&#39;</span>, <span class="st">&#39;D_Season_Num&#39;</span>,<span class="st">&#39;Order Year&#39;</span>, <span class="st">&#39;Customer Country Code&#39;</span>, <span class="st">&#39;Route&#39;</span>, <span class="st">&#39;Order Month&#39;</span>, <span class="st">&#39;Delivery Month&#39;</span>, <span class="st">&#39;Delivery Year&#39;</span>, <span class="st">&#39;Lead_Time_Days&#39;</span>, <span class="st">&#39;Avg_Season_Selection_Rate&#39;</span>, <span class="st">&#39;Items&#39;</span>, <span class="st">&#39;Value&#39;</span>, <span class="st">&#39;Value/Item&#39;</span>,<span class="st">&#39;Lead_Time_Months&#39;</span>, <span class="st">&#39;Urgent&#39;</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Advanced_Urgent&#39;</span>, <span class="st">&#39;Advanced&#39;</span>, <span class="st">&#39;Urgent Items&#39;</span>, <span class="st">&#39;Advanced_Urgent_Items&#39;</span>, <span class="st">&#39;Advanced_Items&#39;</span>]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[features]</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">&#39;Product Code&#39;</span>]</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>le <span class="op">=</span> LabelEncoder()</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>y_encoded <span class="op">=</span> le.fit_transform(y)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [<span class="st">&#39;O_Season_Num&#39;</span>, <span class="st">&#39;D_Season_Num&#39;</span>, <span class="st">&#39;Customer Country Code&#39;</span>, <span class="st">&#39;Route&#39;</span>, <span class="st">&#39;Order Year&#39;</span>, <span class="st">&#39;Delivery Year&#39;</span>, <span class="st">&#39;Lead_Time_Months&#39;</span>]</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>categorical_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;onehot&#39;</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">&#39;ignore&#39;</span>))])</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>numerical_features <span class="op">=</span> [<span class="st">&#39;Lead_Time_Days&#39;</span>, <span class="st">&#39;Avg_Season_Selection_Rate&#39;</span>, <span class="st">&#39;Items&#39;</span>, <span class="st">&#39;Value/Item&#39;</span>, <span class="st">&#39;Urgent Items&#39;</span>, <span class="st">&#39;Advanced_Urgent_Items&#39;</span>,</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;Advanced_Items&#39;</span>]</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>numerical_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;scaler&#39;</span>, StandardScaler())])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2216">
<div class="sourceCode" id="cb57"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code></pre></div>
<div class="output execute_result" data-execution_count="2216">
<pre><code>Index([&#39;Customer Order Code&#39;, &#39;Customer_ID&#39;, &#39;Order Date&#39;, &#39;Order Year&#39;,
       &#39;Order Month&#39;, &#39;O_Season&#39;, &#39;O_Season_Num&#39;, &#39;Requested Delivery Date&#39;,
       &#39;Delivery Year&#39;, &#39;Delivery Month&#39;, &#39;D_Season&#39;, &#39;D_Season_Num&#39;,
       &#39;Year-Season&#39;, &#39;Lead_Time_Days&#39;, &#39;Lead_Time_Months&#39;, &#39;Items&#39;, &#39;Value&#39;,
       &#39;Value/Item&#39;, &#39;Route&#39;, &#39;Product Code&#39;, &#39;Customer Country Code&#39;,
       &#39;advanced_order&#39;, &#39;advanced_order_amount&#39;, &#39;urgent_order_amount&#39;,
       &#39;Urgent&#39;, &#39;Advanced_Urgent&#39;, &#39;Advanced&#39;, &#39;Urgent Items&#39;,
       &#39;Advanced_Urgent_Items&#39;, &#39;Advanced_Items&#39;, &#39;Avg_Season_Selection_Rate&#39;],
      dtype=&#39;object&#39;)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2217">
<div class="sourceCode" id="cb59"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [<span class="st">&#39;O_Season_Num&#39;</span>, <span class="st">&#39;D_Season_Num&#39;</span>, <span class="st">&#39;Order Year&#39;</span>, <span class="st">&#39;Delivery Year&#39;</span>, <span class="st">&#39;Customer Country Code&#39;</span>, <span class="st">&#39;Route&#39;</span>, <span class="st">&#39;Items&#39;</span>, <span class="st">&#39;Advanced_Items&#39;</span>, <span class="st">&#39;Value/Item&#39;</span>, <span class="st">&#39;Lead_Time_Days&#39;</span>, <span class="st">&#39;Lead_Time_Months&#39;</span>, <span class="st">&#39;Avg_Season_Selection_Rate&#39;</span>]</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[features]</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">&#39;Product Code&#39;</span>]</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>le <span class="op">=</span> LabelEncoder()</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>y_encoded <span class="op">=</span> le.fit_transform(y)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [<span class="st">&#39;O_Season_Num&#39;</span>, <span class="st">&#39;D_Season_Num&#39;</span>, <span class="st">&#39;Order Year&#39;</span>, <span class="st">&#39;Delivery Year&#39;</span>, <span class="st">&#39;Customer Country Code&#39;</span>, <span class="st">&#39;Route&#39;</span>]</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>categorical_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;onehot&#39;</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">&#39;ignore&#39;</span>))])</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>numerical_features <span class="op">=</span> [<span class="st">&#39;Items&#39;</span>, <span class="st">&#39;Advanced_Items&#39;</span>, <span class="st">&#39;Value/Item&#39;</span>, <span class="st">&#39;Lead_Time_Days&#39;</span>, <span class="st">&#39;Lead_Time_Months&#39;</span>, <span class="st">&#39;Avg_Season_Selection_Rate&#39;</span>]</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>numerical_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;scaler&#39;</span>, StandardScaler())])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2218">
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&#39;num&#39;</span>, numerical_transformer, numerical_features),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&#39;cat&#39;</span>, categorical_transformer, categorical_features)])</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Pipeline([</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;preprocessor&#39;</span>, preprocessor),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;classifier&#39;</span>, LogisticRegression(max_iter<span class="op">=</span><span class="dv">1000</span>, multi_class<span class="op">=</span><span class="st">&#39;multinomial&#39;</span>))</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2219">
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y_encoded, test_size<span class="op">=</span><span class="fl">0.2</span>, stratify<span class="op">=</span>y_encoded)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>y_pred_probs <span class="op">=</span> model.predict_proba(X_test)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>logloss <span class="op">=</span> log_loss(y_test, y_pred_probs)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Log Loss: </span><span class="sc">{</span>logloss<span class="sc">:.4f}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Log Loss: 1.6785
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2220">
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(y_test, y_pred)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">&#39;</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>probabilities <span class="op">=</span> model.predict_proba(X)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>prob_cols <span class="op">=</span> [<span class="ss">f&#39;prob_</span><span class="sc">{</span>code<span class="sc">}</span><span class="ss">&#39;</span> <span class="cf">for</span> code <span class="kw">in</span> le.classes_]</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>df_probs <span class="op">=</span> pd.DataFrame(probabilities, columns<span class="op">=</span>prob_cols, index<span class="op">=</span>X.index)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>df_with_probs <span class="op">=</span> df.join(df_probs)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>seasonal_choice_probabilities <span class="op">=</span> df_with_probs.groupby(<span class="st">&#39;O_Season_Num&#39;</span>)[prob_cols].mean()</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(seasonal_choice_probabilities)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>Accuracy: 0.4275
              prob_L10705000  prob_L10705100  prob_L10705200  prob_L10705300  \
O_Season_Num                                                                   
1                   0.001506        0.000912        0.001122        0.001520   
2                   0.000782        0.000444        0.000394        0.000369   
3                   0.015675        0.008147        0.010947        0.014206   
4                   0.017605        0.002329        0.004775        0.003472   

              prob_L10705400  prob_L10705500  prob_L10705600  prob_L10705700  \
O_Season_Num                                                                   
1                   0.001606        0.001462        0.001714        0.001054   
2                   0.001037        0.000325        0.001028        0.000408   
3                   0.017549        0.010780        0.015156        0.006577   
4                   0.007965        0.003836        0.022548        0.008397   

              prob_L10850600  prob_L10850700  ...  prob_L12918000  \
O_Season_Num                                  ...                   
1                   0.075049        0.009616  ...        0.000622   
2                   0.142276        0.040387  ...        0.004691   
3                   0.000429        0.000747  ...        0.048033   
4                   0.000701        0.002166  ...        0.094921   

              prob_L12918400  prob_L12918500  prob_L12918600  prob_L12918700  \
O_Season_Num                                                                   
1                   0.003528        0.000738        0.002781        0.002024   
2                   0.002239        0.001971        0.000514        0.002425   
3                   0.085121        0.065636        0.043142        0.082077   
4                   0.047119        0.046151        0.045772        0.041904   

              prob_L12918800  prob_L12918900  prob_L12919000  prob_L12919100  \
O_Season_Num                                                                   
1                   0.000443        0.001035        0.002105        0.001066   
2                   0.000568        0.000997        0.002778        0.000359   
3                   0.020612        0.032533        0.069075        0.029166   
4                   0.025075        0.068831        0.057028        0.019316   

              prob_L12919200  
O_Season_Num                  
1                   0.003279  
2                   0.003430  
3                   0.070898  
4                   0.073699  

[4 rows x 40 columns]
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Checking what features are important for the choice
probabilities.</p>
</div>
<div class="cell code" data-execution_count="2221">
<div class="sourceCode" id="cb65"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_feature_names(column_transformer):</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    output_features <span class="op">=</span> []</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name, pipe, features <span class="kw">in</span> column_transformer.transformers_:</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> name <span class="op">==</span> <span class="st">&#39;remainder&#39;</span>:</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pipe <span class="op">==</span> <span class="st">&#39;passthrough&#39;</span>:</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>                output_features.extend(features)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> step <span class="kw">in</span> pipe.steps:</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> step[<span class="dv">0</span>] <span class="op">==</span> <span class="st">&#39;onehot&#39;</span>:</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">hasattr</span>(step[<span class="dv">1</span>], <span class="st">&#39;get_feature_names_out&#39;</span>):</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>                    feature_names <span class="op">=</span> step[<span class="dv">1</span>].get_feature_names_out(features)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>                    feature_names <span class="op">=</span> step[<span class="dv">1</span>].get_feature_names(features)</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>                feature_names <span class="op">=</span> features</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>        output_features.extend(feature_names)</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_features</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> get_feature_names(model.named_steps[<span class="st">&#39;preprocessor&#39;</span>])</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>coefficients <span class="op">=</span> model.named_steps[<span class="st">&#39;classifier&#39;</span>].coef_[<span class="dv">0</span>]</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="op">=</span> pd.DataFrame({<span class="st">&#39;feature&#39;</span>: feature_names, <span class="st">&#39;coefficient&#39;</span>: coefficients})</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>feature_importance[<span class="st">&#39;abs_coefficient&#39;</span>] <span class="op">=</span> feature_importance[<span class="st">&#39;coefficient&#39;</span>].<span class="bu">abs</span>()</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="op">=</span> feature_importance.sort_values(by<span class="op">=</span><span class="st">&#39;abs_coefficient&#39;</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(feature_importance)</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>                     feature  coefficient  abs_coefficient
14           Order Year_2009     1.242361         1.242361
18        Delivery Year_2010     1.082135         1.082135
16           Order Year_2011    -0.990794         0.990794
20        Delivery Year_2012    -0.917186         0.917186
41  Customer Country Code_NO     0.883428         0.883428
..                       ...          ...              ...
58              Route_CZ0002    -0.000024         0.000024
29  Customer Country Code_CY    -0.000022         0.000022
72              Route_FR02KZ    -0.000022         0.000022
81              Route_SI0001    -0.000021         0.000021
78              Route_RO1001    -0.000010         0.000010

[83 rows x 3 columns]
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2222">
<div class="sourceCode" id="cb67"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>feature_importance.head(<span class="dv">20</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="2222">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>coefficient</th>
      <th>abs_coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14</th>
      <td>Order Year_2009</td>
      <td>1.242361</td>
      <td>1.242361</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Delivery Year_2010</td>
      <td>1.082135</td>
      <td>1.082135</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Order Year_2011</td>
      <td>-0.990794</td>
      <td>0.990794</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Delivery Year_2012</td>
      <td>-0.917186</td>
      <td>0.917186</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Customer Country Code_NO</td>
      <td>0.883428</td>
      <td>0.883428</td>
    </tr>
    <tr>
      <th>76</th>
      <td>Route_NO02FR</td>
      <td>0.883428</td>
      <td>0.883428</td>
    </tr>
    <tr>
      <th>11</th>
      <td>D_Season_Num_2</td>
      <td>0.730295</td>
      <td>0.730295</td>
    </tr>
    <tr>
      <th>6</th>
      <td>O_Season_Num_1</td>
      <td>-0.607198</td>
      <td>0.607198</td>
    </tr>
    <tr>
      <th>13</th>
      <td>D_Season_Num_4</td>
      <td>-0.429817</td>
      <td>0.429817</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Avg_Season_Selection_Rate</td>
      <td>-0.410141</td>
      <td>0.410141</td>
    </tr>
    <tr>
      <th>8</th>
      <td>O_Season_Num_3</td>
      <td>0.403475</td>
      <td>0.403475</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Value/Item</td>
      <td>0.376727</td>
      <td>0.376727</td>
    </tr>
    <tr>
      <th>12</th>
      <td>D_Season_Num_3</td>
      <td>-0.365563</td>
      <td>0.365563</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Lead_Time_Days</td>
      <td>-0.315847</td>
      <td>0.315847</td>
    </tr>
    <tr>
      <th>9</th>
      <td>O_Season_Num_4</td>
      <td>0.311966</td>
      <td>0.311966</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Advanced_Items</td>
      <td>0.227572</td>
      <td>0.227572</td>
    </tr>
    <tr>
      <th>75</th>
      <td>Route_IT0000</td>
      <td>-0.217730</td>
      <td>0.217730</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Customer Country Code_IT</td>
      <td>-0.217730</td>
      <td>0.217730</td>
    </tr>
    <tr>
      <th>60</th>
      <td>Route_DK01FR</td>
      <td>-0.213753</td>
      <td>0.213753</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Customer Country Code_DK</td>
      <td>-0.211948</td>
      <td>0.211948</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>Often we can see that delivery and order season matter.</p>
</div>
<div class="cell code" data-execution_count="2223">
<div class="sourceCode" id="cb68"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>o_season_importance <span class="op">=</span> feature_importance[feature_importance[<span class="st">&#39;feature&#39;</span>].<span class="bu">str</span>.startswith(<span class="st">&#39;O_Season_Num&#39;</span>)]</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(o_season_importance)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>          feature  coefficient  abs_coefficient
6  O_Season_Num_1    -0.607198         0.607198
8  O_Season_Num_3     0.403475         0.403475
9  O_Season_Num_4     0.311966         0.311966
7  O_Season_Num_2    -0.108212         0.108212
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>I want to see if aggregating by month before calculating choise
probabilities helps improve the calculation. I'll do that here:</p>
</div>
<div class="cell code" data-execution_count="2224">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>monthly_df <span class="op">=</span> df.groupby([<span class="st">&#39;Order Year&#39;</span>, <span class="st">&#39;Order Month&#39;</span>]).agg({<span class="st">&#39;O_Season_Num&#39;</span>:<span class="st">&#39;max&#39;</span>,<span class="st">&#39;Items&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;Value&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;Value/Item&#39;</span>: <span class="st">&#39;mean&#39;</span>, <span class="st">&#39;Urgent Items&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;Advanced_Urgent_Items&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;Advanced_Items&#39;</span>: <span class="st">&#39;sum&#39;</span>, <span class="st">&#39;Lead_Time_Months&#39;</span>: <span class="st">&#39;mean&#39;</span>}).reset_index()</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>monthly_df.rename(columns<span class="op">=</span>{<span class="st">&#39;Items&#39;</span>: <span class="st">&#39;Demand&#39;</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>monthly_df.head(<span class="dv">30</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="2224">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order Year</th>
      <th>Order Month</th>
      <th>O_Season_Num</th>
      <th>Demand</th>
      <th>Value</th>
      <th>Value/Item</th>
      <th>Urgent Items</th>
      <th>Advanced_Urgent_Items</th>
      <th>Advanced_Items</th>
      <th>Lead_Time_Months</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2009</td>
      <td>7</td>
      <td>3</td>
      <td>1067</td>
      <td>462065.60</td>
      <td>431.765957</td>
      <td>0</td>
      <td>0</td>
      <td>1067</td>
      <td>6.712963</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009</td>
      <td>8</td>
      <td>3</td>
      <td>137</td>
      <td>45673.86</td>
      <td>153.683100</td>
      <td>0</td>
      <td>0</td>
      <td>137</td>
      <td>7.400000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2009</td>
      <td>9</td>
      <td>4</td>
      <td>70</td>
      <td>1692.29</td>
      <td>25.672345</td>
      <td>0</td>
      <td>0</td>
      <td>70</td>
      <td>6.785714</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2009</td>
      <td>10</td>
      <td>4</td>
      <td>10</td>
      <td>97.42</td>
      <td>9.856667</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
      <td>7.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2009</td>
      <td>11</td>
      <td>4</td>
      <td>630</td>
      <td>12492.89</td>
      <td>19.829977</td>
      <td>0</td>
      <td>0</td>
      <td>630</td>
      <td>8.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2009</td>
      <td>12</td>
      <td>1</td>
      <td>361</td>
      <td>159934.26</td>
      <td>444.850714</td>
      <td>0</td>
      <td>0</td>
      <td>361</td>
      <td>8.857143</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2010</td>
      <td>1</td>
      <td>1</td>
      <td>187</td>
      <td>20266.37</td>
      <td>62.826842</td>
      <td>0</td>
      <td>0</td>
      <td>187</td>
      <td>7.500000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2010</td>
      <td>2</td>
      <td>1</td>
      <td>370</td>
      <td>74925.83</td>
      <td>111.116303</td>
      <td>0</td>
      <td>0</td>
      <td>370</td>
      <td>6.836364</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2010</td>
      <td>3</td>
      <td>2</td>
      <td>314</td>
      <td>14282.48</td>
      <td>39.301630</td>
      <td>0</td>
      <td>0</td>
      <td>314</td>
      <td>6.376623</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2010</td>
      <td>4</td>
      <td>2</td>
      <td>81</td>
      <td>804.00</td>
      <td>9.515385</td>
      <td>0</td>
      <td>0</td>
      <td>81</td>
      <td>4.538462</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2010</td>
      <td>5</td>
      <td>2</td>
      <td>7</td>
      <td>70.16</td>
      <td>8.900833</td>
      <td>0</td>
      <td>0</td>
      <td>7</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2010</td>
      <td>6</td>
      <td>3</td>
      <td>3</td>
      <td>68.55</td>
      <td>22.850000</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2010</td>
      <td>12</td>
      <td>1</td>
      <td>705</td>
      <td>305310.94</td>
      <td>441.371217</td>
      <td>0</td>
      <td>0</td>
      <td>705</td>
      <td>9.898551</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>1750</td>
      <td>28809.93</td>
      <td>22.071549</td>
      <td>0</td>
      <td>0</td>
      <td>1750</td>
      <td>7.306533</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2011</td>
      <td>2</td>
      <td>1</td>
      <td>871</td>
      <td>36957.84</td>
      <td>55.271061</td>
      <td>0</td>
      <td>0</td>
      <td>871</td>
      <td>7.102362</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2011</td>
      <td>3</td>
      <td>2</td>
      <td>270</td>
      <td>32875.97</td>
      <td>92.567802</td>
      <td>0</td>
      <td>0</td>
      <td>270</td>
      <td>6.655172</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2011</td>
      <td>4</td>
      <td>2</td>
      <td>47</td>
      <td>8456.14</td>
      <td>127.630000</td>
      <td>0</td>
      <td>0</td>
      <td>47</td>
      <td>6.333333</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2011</td>
      <td>5</td>
      <td>2</td>
      <td>14</td>
      <td>2874.31</td>
      <td>130.858333</td>
      <td>0</td>
      <td>0</td>
      <td>14</td>
      <td>3.666667</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2011</td>
      <td>6</td>
      <td>3</td>
      <td>45</td>
      <td>981.28</td>
      <td>31.923333</td>
      <td>0</td>
      <td>0</td>
      <td>45</td>
      <td>8.000000</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2011</td>
      <td>7</td>
      <td>3</td>
      <td>6616</td>
      <td>1325577.05</td>
      <td>198.429873</td>
      <td>0</td>
      <td>73</td>
      <td>6543</td>
      <td>8.396411</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2011</td>
      <td>8</td>
      <td>3</td>
      <td>2408</td>
      <td>226406.43</td>
      <td>72.650133</td>
      <td>175</td>
      <td>37</td>
      <td>2196</td>
      <td>6.974811</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2011</td>
      <td>9</td>
      <td>4</td>
      <td>983</td>
      <td>33699.17</td>
      <td>30.583018</td>
      <td>44</td>
      <td>0</td>
      <td>939</td>
      <td>5.913514</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2011</td>
      <td>10</td>
      <td>4</td>
      <td>62</td>
      <td>750.38</td>
      <td>12.748772</td>
      <td>0</td>
      <td>0</td>
      <td>62</td>
      <td>5.578947</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2011</td>
      <td>11</td>
      <td>4</td>
      <td>57</td>
      <td>556.80</td>
      <td>9.880000</td>
      <td>0</td>
      <td>2</td>
      <td>55</td>
      <td>3.500000</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2012</td>
      <td>1</td>
      <td>1</td>
      <td>42</td>
      <td>17568.60</td>
      <td>418.300000</td>
      <td>0</td>
      <td>0</td>
      <td>42</td>
      <td>5.400000</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2012</td>
      <td>4</td>
      <td>2</td>
      <td>7</td>
      <td>49.91</td>
      <td>7.130000</td>
      <td>0</td>
      <td>0</td>
      <td>7</td>
      <td>6.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p><strong>I will now look to create my future month demand forecast
based on advanced orders in my combined dataframe</strong></p>
</div>
<div class="cell code" data-execution_count="2225">
<div class="sourceCode" id="cb71"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>monthly_df[<span class="st">&#39;Total_Advanced&#39;</span>] <span class="op">=</span> monthly_df[<span class="st">&#39;Advanced_Urgent_Items&#39;</span>] <span class="op">+</span> monthly_df[<span class="st">&#39;Advanced_Items&#39;</span>]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2226">
<div class="sourceCode" id="cb72"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>monthly_df[<span class="st">&#39;Previous_Month_Items&#39;</span>] <span class="op">=</span> monthly_df[<span class="st">&#39;Demand&#39;</span>].shift(<span class="dv">1</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>monthly_df[<span class="st">&#39;Previous_Month_Urgent&#39;</span>] <span class="op">=</span> monthly_df[<span class="st">&#39;Urgent Items&#39;</span>].shift(<span class="dv">1</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>monthly_df[<span class="st">&#39;Previous_Month_Advanced_Urgent_Items&#39;</span>] <span class="op">=</span> monthly_df[<span class="st">&#39;Advanced_Urgent_Items&#39;</span>].shift(<span class="dv">1</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>monthly_df[<span class="st">&#39;Previous_Month_Advanced_Items&#39;</span>] <span class="op">=</span> monthly_df[<span class="st">&#39;Advanced_Items&#39;</span>].shift(<span class="dv">1</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>monthly_df[<span class="st">&#39;Previous_Month_Total_Advanced&#39;</span>] <span class="op">=</span> monthly_df[<span class="st">&#39;Total_Advanced&#39;</span>].shift(<span class="dv">1</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>monthly_df[<span class="st">&#39;Demand_Prv_Yr&#39;</span>] <span class="op">=</span> monthly_df[<span class="st">&#39;Demand&#39;</span>].shift(<span class="dv">12</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>monthly_df[<span class="st">&#39;Total_Advanced_Prev_6_Months&#39;</span>] <span class="op">=</span> monthly_df[<span class="st">&#39;Total_Advanced&#39;</span>].shift(<span class="dv">6</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2227">
<div class="sourceCode" id="cb73"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>monthly_df.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2228">
<div class="sourceCode" id="cb74"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>monthly_df.head(<span class="dv">30</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="2228">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order Year</th>
      <th>Order Month</th>
      <th>O_Season_Num</th>
      <th>Demand</th>
      <th>Value</th>
      <th>Value/Item</th>
      <th>Urgent Items</th>
      <th>Advanced_Urgent_Items</th>
      <th>Advanced_Items</th>
      <th>Lead_Time_Months</th>
      <th>Total_Advanced</th>
      <th>Previous_Month_Items</th>
      <th>Previous_Month_Urgent</th>
      <th>Previous_Month_Advanced_Urgent_Items</th>
      <th>Previous_Month_Advanced_Items</th>
      <th>Previous_Month_Total_Advanced</th>
      <th>Demand_Prv_Yr</th>
      <th>Total_Advanced_Prev_6_Months</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2009</td>
      <td>7</td>
      <td>3</td>
      <td>1067</td>
      <td>462065.60</td>
      <td>431.765957</td>
      <td>0</td>
      <td>0</td>
      <td>1067</td>
      <td>6.712963</td>
      <td>1067</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009</td>
      <td>8</td>
      <td>3</td>
      <td>137</td>
      <td>45673.86</td>
      <td>153.683100</td>
      <td>0</td>
      <td>0</td>
      <td>137</td>
      <td>7.400000</td>
      <td>137</td>
      <td>1067.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1067.0</td>
      <td>1067.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2009</td>
      <td>9</td>
      <td>4</td>
      <td>70</td>
      <td>1692.29</td>
      <td>25.672345</td>
      <td>0</td>
      <td>0</td>
      <td>70</td>
      <td>6.785714</td>
      <td>70</td>
      <td>137.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>137.0</td>
      <td>137.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2009</td>
      <td>10</td>
      <td>4</td>
      <td>10</td>
      <td>97.42</td>
      <td>9.856667</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
      <td>7.000000</td>
      <td>10</td>
      <td>70.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2009</td>
      <td>11</td>
      <td>4</td>
      <td>630</td>
      <td>12492.89</td>
      <td>19.829977</td>
      <td>0</td>
      <td>0</td>
      <td>630</td>
      <td>8.000000</td>
      <td>630</td>
      <td>10.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2009</td>
      <td>12</td>
      <td>1</td>
      <td>361</td>
      <td>159934.26</td>
      <td>444.850714</td>
      <td>0</td>
      <td>0</td>
      <td>361</td>
      <td>8.857143</td>
      <td>361</td>
      <td>630.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>630.0</td>
      <td>630.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2010</td>
      <td>1</td>
      <td>1</td>
      <td>187</td>
      <td>20266.37</td>
      <td>62.826842</td>
      <td>0</td>
      <td>0</td>
      <td>187</td>
      <td>7.500000</td>
      <td>187</td>
      <td>361.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>361.0</td>
      <td>361.0</td>
      <td>0.0</td>
      <td>1067.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2010</td>
      <td>2</td>
      <td>1</td>
      <td>370</td>
      <td>74925.83</td>
      <td>111.116303</td>
      <td>0</td>
      <td>0</td>
      <td>370</td>
      <td>6.836364</td>
      <td>370</td>
      <td>187.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>187.0</td>
      <td>187.0</td>
      <td>0.0</td>
      <td>137.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2010</td>
      <td>3</td>
      <td>2</td>
      <td>314</td>
      <td>14282.48</td>
      <td>39.301630</td>
      <td>0</td>
      <td>0</td>
      <td>314</td>
      <td>6.376623</td>
      <td>314</td>
      <td>370.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>370.0</td>
      <td>370.0</td>
      <td>0.0</td>
      <td>70.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2010</td>
      <td>4</td>
      <td>2</td>
      <td>81</td>
      <td>804.00</td>
      <td>9.515385</td>
      <td>0</td>
      <td>0</td>
      <td>81</td>
      <td>4.538462</td>
      <td>81</td>
      <td>314.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>314.0</td>
      <td>314.0</td>
      <td>0.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2010</td>
      <td>5</td>
      <td>2</td>
      <td>7</td>
      <td>70.16</td>
      <td>8.900833</td>
      <td>0</td>
      <td>0</td>
      <td>7</td>
      <td>6.000000</td>
      <td>7</td>
      <td>81.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>81.0</td>
      <td>81.0</td>
      <td>0.0</td>
      <td>630.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2010</td>
      <td>6</td>
      <td>3</td>
      <td>3</td>
      <td>68.55</td>
      <td>22.850000</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>3.000000</td>
      <td>3</td>
      <td>7.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>0.0</td>
      <td>361.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2010</td>
      <td>12</td>
      <td>1</td>
      <td>705</td>
      <td>305310.94</td>
      <td>441.371217</td>
      <td>0</td>
      <td>0</td>
      <td>705</td>
      <td>9.898551</td>
      <td>705</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>1067.0</td>
      <td>187.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>1750</td>
      <td>28809.93</td>
      <td>22.071549</td>
      <td>0</td>
      <td>0</td>
      <td>1750</td>
      <td>7.306533</td>
      <td>1750</td>
      <td>705.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>705.0</td>
      <td>705.0</td>
      <td>137.0</td>
      <td>370.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2011</td>
      <td>2</td>
      <td>1</td>
      <td>871</td>
      <td>36957.84</td>
      <td>55.271061</td>
      <td>0</td>
      <td>0</td>
      <td>871</td>
      <td>7.102362</td>
      <td>871</td>
      <td>1750.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1750.0</td>
      <td>1750.0</td>
      <td>70.0</td>
      <td>314.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2011</td>
      <td>3</td>
      <td>2</td>
      <td>270</td>
      <td>32875.97</td>
      <td>92.567802</td>
      <td>0</td>
      <td>0</td>
      <td>270</td>
      <td>6.655172</td>
      <td>270</td>
      <td>871.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>871.0</td>
      <td>871.0</td>
      <td>10.0</td>
      <td>81.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2011</td>
      <td>4</td>
      <td>2</td>
      <td>47</td>
      <td>8456.14</td>
      <td>127.630000</td>
      <td>0</td>
      <td>0</td>
      <td>47</td>
      <td>6.333333</td>
      <td>47</td>
      <td>270.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>270.0</td>
      <td>270.0</td>
      <td>630.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2011</td>
      <td>5</td>
      <td>2</td>
      <td>14</td>
      <td>2874.31</td>
      <td>130.858333</td>
      <td>0</td>
      <td>0</td>
      <td>14</td>
      <td>3.666667</td>
      <td>14</td>
      <td>47.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>47.0</td>
      <td>47.0</td>
      <td>361.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2011</td>
      <td>6</td>
      <td>3</td>
      <td>45</td>
      <td>981.28</td>
      <td>31.923333</td>
      <td>0</td>
      <td>0</td>
      <td>45</td>
      <td>8.000000</td>
      <td>45</td>
      <td>14.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>14.0</td>
      <td>14.0</td>
      <td>187.0</td>
      <td>705.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2011</td>
      <td>7</td>
      <td>3</td>
      <td>6616</td>
      <td>1325577.05</td>
      <td>198.429873</td>
      <td>0</td>
      <td>73</td>
      <td>6543</td>
      <td>8.396411</td>
      <td>6616</td>
      <td>45.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>45.0</td>
      <td>45.0</td>
      <td>370.0</td>
      <td>1750.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2011</td>
      <td>8</td>
      <td>3</td>
      <td>2408</td>
      <td>226406.43</td>
      <td>72.650133</td>
      <td>175</td>
      <td>37</td>
      <td>2196</td>
      <td>6.974811</td>
      <td>2233</td>
      <td>6616.0</td>
      <td>0.0</td>
      <td>73.0</td>
      <td>6543.0</td>
      <td>6616.0</td>
      <td>314.0</td>
      <td>871.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2011</td>
      <td>9</td>
      <td>4</td>
      <td>983</td>
      <td>33699.17</td>
      <td>30.583018</td>
      <td>44</td>
      <td>0</td>
      <td>939</td>
      <td>5.913514</td>
      <td>939</td>
      <td>2408.0</td>
      <td>175.0</td>
      <td>37.0</td>
      <td>2196.0</td>
      <td>2233.0</td>
      <td>81.0</td>
      <td>270.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2011</td>
      <td>10</td>
      <td>4</td>
      <td>62</td>
      <td>750.38</td>
      <td>12.748772</td>
      <td>0</td>
      <td>0</td>
      <td>62</td>
      <td>5.578947</td>
      <td>62</td>
      <td>983.0</td>
      <td>44.0</td>
      <td>0.0</td>
      <td>939.0</td>
      <td>939.0</td>
      <td>7.0</td>
      <td>47.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2011</td>
      <td>11</td>
      <td>4</td>
      <td>57</td>
      <td>556.80</td>
      <td>9.880000</td>
      <td>0</td>
      <td>2</td>
      <td>55</td>
      <td>3.500000</td>
      <td>57</td>
      <td>62.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>62.0</td>
      <td>62.0</td>
      <td>3.0</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2012</td>
      <td>1</td>
      <td>1</td>
      <td>42</td>
      <td>17568.60</td>
      <td>418.300000</td>
      <td>0</td>
      <td>0</td>
      <td>42</td>
      <td>5.400000</td>
      <td>42</td>
      <td>57.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>55.0</td>
      <td>57.0</td>
      <td>705.0</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2012</td>
      <td>4</td>
      <td>2</td>
      <td>7</td>
      <td>49.91</td>
      <td>7.130000</td>
      <td>0</td>
      <td>0</td>
      <td>7</td>
      <td>6.000000</td>
      <td>7</td>
      <td>42.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>42.0</td>
      <td>42.0</td>
      <td>1750.0</td>
      <td>6616.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="2229">
<div class="sourceCode" id="cb75"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>plt.plot(monthly_df[<span class="st">&#39;Order Year&#39;</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">&#39;-&#39;</span> <span class="op">+</span> monthly_df[<span class="st">&#39;Order Month&#39;</span>].astype(<span class="bu">str</span>), monthly_df[<span class="st">&#39;Demand&#39;</span>], label<span class="op">=</span><span class="st">&#39;Demand&#39;</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>plt.plot(monthly_df[<span class="st">&#39;Order Year&#39;</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">&#39;-&#39;</span> <span class="op">+</span> monthly_df[<span class="st">&#39;Order Month&#39;</span>].astype(<span class="bu">str</span>), monthly_df[<span class="st">&#39;Total_Advanced&#39;</span>], label<span class="op">=</span><span class="st">&#39;Total Advanced&#39;</span>)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Month&#39;</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Quantity&#39;</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Demand vs Total Advanced per Month over Years&#39;</span>)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_9c521f475cad414ea18971055c4e8e19/e14141cd189603b662c1ff481e1e1105c7af346a.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>We can see that the company almost always has orders that require
delivery in more than 30 days, making them advanced orders. Only a few
times is this not the case (2011 month 8 &amp; 9)</p>
</div>
<div class="cell code" data-execution_count="2230">
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>monthly_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2230">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Order Year</th>
      <th>Order Month</th>
      <th>O_Season_Num</th>
      <th>Demand</th>
      <th>Value</th>
      <th>Value/Item</th>
      <th>Urgent Items</th>
      <th>Advanced_Urgent_Items</th>
      <th>Advanced_Items</th>
      <th>Lead_Time_Months</th>
      <th>Total_Advanced</th>
      <th>Previous_Month_Items</th>
      <th>Previous_Month_Urgent</th>
      <th>Previous_Month_Advanced_Urgent_Items</th>
      <th>Previous_Month_Advanced_Items</th>
      <th>Previous_Month_Total_Advanced</th>
      <th>Demand_Prv_Yr</th>
      <th>Total_Advanced_Prev_6_Months</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2009</td>
      <td>7</td>
      <td>3</td>
      <td>1067</td>
      <td>462065.60</td>
      <td>431.765957</td>
      <td>0</td>
      <td>0</td>
      <td>1067</td>
      <td>6.712963</td>
      <td>1067</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009</td>
      <td>8</td>
      <td>3</td>
      <td>137</td>
      <td>45673.86</td>
      <td>153.683100</td>
      <td>0</td>
      <td>0</td>
      <td>137</td>
      <td>7.400000</td>
      <td>137</td>
      <td>1067.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1067.0</td>
      <td>1067.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2009</td>
      <td>9</td>
      <td>4</td>
      <td>70</td>
      <td>1692.29</td>
      <td>25.672345</td>
      <td>0</td>
      <td>0</td>
      <td>70</td>
      <td>6.785714</td>
      <td>70</td>
      <td>137.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>137.0</td>
      <td>137.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2009</td>
      <td>10</td>
      <td>4</td>
      <td>10</td>
      <td>97.42</td>
      <td>9.856667</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
      <td>7.000000</td>
      <td>10</td>
      <td>70.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2009</td>
      <td>11</td>
      <td>4</td>
      <td>630</td>
      <td>12492.89</td>
      <td>19.829977</td>
      <td>0</td>
      <td>0</td>
      <td>630</td>
      <td>8.000000</td>
      <td>630</td>
      <td>10.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>Remove the first two months as they have NA values, so predictions
can only be made by the 3rd month.</p>
</div>
<div class="cell code" data-execution_count="2231">
<div class="sourceCode" id="cb77"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>monthly_df_copy <span class="op">=</span> monthly_df.copy()</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2232">
<div class="sourceCode" id="cb78"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>monthly_df.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2233">
<div class="sourceCode" id="cb79"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> monthly_df[[<span class="st">&#39;Previous_Month_Items&#39;</span>,<span class="st">&#39;Previous_Month_Urgent&#39;</span>, <span class="st">&#39;Previous_Month_Advanced_Urgent_Items&#39;</span>, <span class="st">&#39;Previous_Month_Advanced_Items&#39;</span>,<span class="st">&#39;Previous_Month_Total_Advanced&#39;</span>, <span class="st">&#39;Demand_Prv_Yr&#39;</span>, <span class="st">&#39;Total_Advanced_Prev_6_Months&#39;</span>]]</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> monthly_df[<span class="st">&#39;Demand&#39;</span>]</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Ridge()</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {<span class="st">&#39;alpha&#39;</span>: [<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>]}</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(model, parameters, scoring<span class="op">=</span><span class="st">&#39;neg_mean_squared_error&#39;</span>, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>grid_search.fit(X_train, y_train)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>best_alpha <span class="op">=</span> grid_search.best_params_[<span class="st">&#39;alpha&#39;</span>]</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Best alpha: </span><span class="sc">{</span>best_alpha<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Ridge(alpha<span class="op">=</span>best_alpha)</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> mean_absolute_error(y_test, y_pred)</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Mean Squared Error: </span><span class="sc">{</span>mse<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Mean Absolute Error: </span><span class="sc">{</span>mae<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>avg_actual <span class="op">=</span> y.mean()</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>mae_ratio <span class="op">=</span> mae <span class="op">/</span> avg_actual</span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MAE Ratio: </span><span class="sc">{</span>mae_ratio<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X)</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> pd.DataFrame({<span class="st">&#39;Year&#39;</span>: monthly_df[<span class="st">&#39;Order Year&#39;</span>], <span class="st">&#39;Month&#39;</span>: monthly_df[<span class="st">&#39;Order Month&#39;</span>], <span class="st">&#39;O_Season_Num&#39;</span>: monthly_df[<span class="st">&#39;O_Season_Num&#39;</span>], <span class="st">&#39;Actual&#39;</span>: y, <span class="st">&#39;Predicted&#39;</span>: y_pred})</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(predictions)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best alpha: 100
Mean Squared Error: 255786.3373
Mean Absolute Error: 485.5055
MAE Ratio: 0.7376
    Year  Month  O_Season_Num  Actual    Predicted
0   2009      7             3    1067   689.534588
1   2009      8             3     137   555.525953
2   2009      9             4      70   672.328231
3   2009     10             4      10   680.743019
4   2009     11             4     630   688.278650
5   2009     12             1     361   610.410464
6   2010      1             1     187   847.352888
7   2010      2             1     370   692.133452
8   2010      3             2     314   656.392922
9   2010      4             2      81   652.002128
10  2010      5             2       7   799.314006
11  2010      6             3       3   757.390129
12  2010     12             1     705   357.418972
13  2011      1             1    1750   624.273252
14  2011      2             1     871   505.431808
15  2011      3             2     270   592.122042
16  2011      4             2      47   440.062410
17  2011      5             2      14   559.918805
18  2011      6             3      45   757.629016
19  2011      7             3    6616   889.701737
20  2011      8             3    2408  2416.285083
21  2011      9             4     983   907.361372
22  2011     10             4      62   378.924331
23  2011     11             4      57   683.380550
24  2012      1             1      42   516.719937
25  2012      4             2       7  1341.466369
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2234">
<div class="sourceCode" id="cb81"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> monthly_df[[<span class="st">&#39;Previous_Month_Items&#39;</span>, <span class="st">&#39;Previous_Month_Advanced_Urgent_Items&#39;</span>, </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;Previous_Month_Advanced_Items&#39;</span>, <span class="st">&#39;Previous_Month_Total_Advanced&#39;</span>, </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;Demand_Prv_Yr&#39;</span>]]</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> monthly_df[<span class="st">&#39;Demand&#39;</span>]</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2235">
<div class="sourceCode" id="cb82"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> []</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>numerical_features <span class="op">=</span> [<span class="st">&#39;Previous_Month_Items&#39;</span>, <span class="st">&#39;Previous_Month_Advanced_Urgent_Items&#39;</span>, </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;Previous_Month_Advanced_Items&#39;</span>, <span class="st">&#39;Previous_Month_Total_Advanced&#39;</span>, </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;Demand_Prv_Yr&#39;</span>]</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>numerical_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;scaler&#39;</span>, StandardScaler())])</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>categorical_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;onehot&#39;</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">&#39;ignore&#39;</span>))])</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&#39;num&#39;</span>, numerical_transformer, numerical_features),</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&#39;cat&#39;</span>, categorical_transformer, categorical_features)])</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>ridge_pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;preprocessor&#39;</span>, preprocessor),</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;ridge&#39;</span>, Ridge())</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2236">
<div class="sourceCode" id="cb83"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {<span class="st">&#39;ridge__alpha&#39;</span>: [<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>]}</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(ridge_pipeline, parameters, scoring<span class="op">=</span><span class="st">&#39;neg_mean_squared_error&#39;</span>, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>grid_search.fit(X_train, y_train)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>best_alpha <span class="op">=</span> grid_search.best_params_[<span class="st">&#39;ridge__alpha&#39;</span>]</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Best alpha: </span><span class="sc">{</span>best_alpha<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>ridge_model <span class="op">=</span> Pipeline([</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;preprocessor&#39;</span>, preprocessor),</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;ridge&#39;</span>, Ridge(alpha<span class="op">=</span>best_alpha))</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>ridge_model.fit(X_train, y_train)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best alpha: 100
</code></pre>
</div>
<div class="output execute_result" data-execution_count="2236">
<style>#sk-container-id-22 {color: black;}#sk-container-id-22 pre{padding: 0;}#sk-container-id-22 div.sk-toggleable {background-color: white;}#sk-container-id-22 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-22 label.sk-toggleable__label-arrow:before {content: "";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-22 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-22 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-22 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-22 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-22 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-22 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "";}#sk-container-id-22 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-22 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-22 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-22 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-22 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-22 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-22 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-22 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-22 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-22 div.sk-item {position: relative;z-index: 1;}#sk-container-id-22 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-22 div.sk-item::before, #sk-container-id-22 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-22 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-22 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-22 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-22 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-22 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-22 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-22 div.sk-label-container {text-align: center;}#sk-container-id-22 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-22 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-22" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;Previous_Month_Items&#x27;,
                                                   &#x27;Previous_Month_Advanced_Urgent_Items&#x27;,
                                                   &#x27;Previous_Month_Advanced_Items&#x27;,
                                                   &#x27;Previous_Month_Total_Advanced&#x27;,
                                                   &#x27;Demand_Prv_Yr&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;onehot&#x27;,
                                                                   OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                                  [])])),
                (&#x27;ridge&#x27;, Ridge(alpha=100))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-148" type="checkbox" ><label for="sk-estimator-id-148" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;Previous_Month_Items&#x27;,
                                                   &#x27;Previous_Month_Advanced_Urgent_Items&#x27;,
                                                   &#x27;Previous_Month_Advanced_Items&#x27;,
                                                   &#x27;Previous_Month_Total_Advanced&#x27;,
                                                   &#x27;Demand_Prv_Yr&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;onehot&#x27;,
                                                                   OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                                  [])])),
                (&#x27;ridge&#x27;, Ridge(alpha=100))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-149" type="checkbox" ><label for="sk-estimator-id-149" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                 Pipeline(steps=[(&#x27;scaler&#x27;, StandardScaler())]),
                                 [&#x27;Previous_Month_Items&#x27;,
                                  &#x27;Previous_Month_Advanced_Urgent_Items&#x27;,
                                  &#x27;Previous_Month_Advanced_Items&#x27;,
                                  &#x27;Previous_Month_Total_Advanced&#x27;,
                                  &#x27;Demand_Prv_Yr&#x27;]),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;onehot&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                 [])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-150" type="checkbox" ><label for="sk-estimator-id-150" class="sk-toggleable__label sk-toggleable__label-arrow">num</label><div class="sk-toggleable__content"><pre>[&#x27;Previous_Month_Items&#x27;, &#x27;Previous_Month_Advanced_Urgent_Items&#x27;, &#x27;Previous_Month_Advanced_Items&#x27;, &#x27;Previous_Month_Total_Advanced&#x27;, &#x27;Demand_Prv_Yr&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-151" type="checkbox" ><label for="sk-estimator-id-151" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-152" type="checkbox" ><label for="sk-estimator-id-152" class="sk-toggleable__label sk-toggleable__label-arrow">cat</label><div class="sk-toggleable__content"><pre>[]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-153" type="checkbox" ><label for="sk-estimator-id-153" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-154" type="checkbox" ><label for="sk-estimator-id-154" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge(alpha=100)</pre></div></div></div></div></div></div></div>
</div>
</div>
<div class="cell code" data-execution_count="2237">
<div class="sourceCode" id="cb85"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> ridge_model.predict(X_test)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> mean_absolute_error(y_test, y_pred)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Mean Squared Error: </span><span class="sc">{</span>mse<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Mean Absolute Error: </span><span class="sc">{</span>mae<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>avg_actual <span class="op">=</span> y.mean()</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>mae_ratio <span class="op">=</span> mae <span class="op">/</span> avg_actual</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MAE Ratio: </span><span class="sc">{</span>mae_ratio<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>y_pred_full <span class="op">=</span> ridge_model.predict(X)</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> pd.DataFrame({</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Year&#39;</span>: monthly_df[<span class="st">&#39;Order Year&#39;</span>], </span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Month&#39;</span>: monthly_df[<span class="st">&#39;Order Month&#39;</span>], </span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;O_Season_Num&#39;</span>: monthly_df[<span class="st">&#39;O_Season_Num&#39;</span>], </span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Actual&#39;</span>: y, </span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Predicted&#39;</span>: y_pred_full</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(predictions)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Mean Squared Error: 360342.7186
Mean Absolute Error: 583.9777
MAE Ratio: 0.8872
    Year  Month  O_Season_Num  Actual    Predicted
0   2009      7             3    1067   695.285291
1   2009      8             3     137   774.180446
2   2009      9             4      70   705.415222
3   2009     10             4      10   700.461168
4   2009     11             4     630   696.024702
5   2009     12             1     361   741.868185
6   2010      1             1     187   721.978029
7   2010      2             1     370   709.112277
8   2010      3             2     314   722.643498
9   2010      4             2      81   718.502797
10  2010      5             2       7   701.274520
11  2010      6             3       3   695.802879
12  2010     12             1     705   745.473871
13  2011      1             1    1750   753.829368
14  2011      2             1     871   827.960263
15  2011      3             2     270   760.156282
16  2011      4             2      47   744.751785
17  2011      5             2      14   715.665864
18  2011      6             3      45   705.077527
19  2011      7             3    6616   715.939445
20  2011      8             3    2408  1379.357270
21  2011      9             4     983   959.760851
22  2011     10             4      62   766.112665
23  2011     11             4      57   700.010127
24  2012      1             1      42   737.450775
25  2012      4             2       7   780.341918
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2238">
<div class="sourceCode" id="cb87"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>predictions.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2238">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Month</th>
      <th>O_Season_Num</th>
      <th>Actual</th>
      <th>Predicted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2009</td>
      <td>7</td>
      <td>3</td>
      <td>1067</td>
      <td>695.285291</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009</td>
      <td>8</td>
      <td>3</td>
      <td>137</td>
      <td>774.180446</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2009</td>
      <td>9</td>
      <td>4</td>
      <td>70</td>
      <td>705.415222</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2009</td>
      <td>10</td>
      <td>4</td>
      <td>10</td>
      <td>700.461168</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2009</td>
      <td>11</td>
      <td>4</td>
      <td>630</td>
      <td>696.024702</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="2239">
<div class="sourceCode" id="cb88"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>plt.plot(predictions[<span class="st">&#39;Actual&#39;</span>], label<span class="op">=</span><span class="st">&#39;Actual&#39;</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>plt.plot(predictions[<span class="st">&#39;Predicted&#39;</span>], label<span class="op">=</span><span class="st">&#39;Predicted&#39;</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Index&#39;</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Value&#39;</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Predicted vs Actual&#39;</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_9c521f475cad414ea18971055c4e8e19/23d222ac8023826eebcaa4a21fc471ace4630001.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>Now that we have our monthly demand estimates, I will combine them
with each seasons product choice probability to find out how the
projected demand breaks down to a SKU level.</p>
</div>
<div class="cell code" data-execution_count="2240">
<div class="sourceCode" id="cb89"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.merge(predictions, seasonal_choice_probabilities, left_on<span class="op">=</span><span class="st">&#39;O_Season_Num&#39;</span>, right_index<span class="op">=</span><span class="va">True</span>, how<span class="op">=</span><span class="st">&#39;left&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2241">
<div class="sourceCode" id="cb90"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>merged_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="2241">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Month</th>
      <th>O_Season_Num</th>
      <th>Actual</th>
      <th>Predicted</th>
      <th>prob_L10705000</th>
      <th>prob_L10705100</th>
      <th>prob_L10705200</th>
      <th>prob_L10705300</th>
      <th>prob_L10705400</th>
      <th>...</th>
      <th>prob_L12918000</th>
      <th>prob_L12918400</th>
      <th>prob_L12918500</th>
      <th>prob_L12918600</th>
      <th>prob_L12918700</th>
      <th>prob_L12918800</th>
      <th>prob_L12918900</th>
      <th>prob_L12919000</th>
      <th>prob_L12919100</th>
      <th>prob_L12919200</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2009</td>
      <td>7</td>
      <td>3</td>
      <td>1067</td>
      <td>695.285291</td>
      <td>0.015675</td>
      <td>0.008147</td>
      <td>0.010947</td>
      <td>0.014206</td>
      <td>0.017549</td>
      <td>...</td>
      <td>0.048033</td>
      <td>0.085121</td>
      <td>0.065636</td>
      <td>0.043142</td>
      <td>0.082077</td>
      <td>0.020612</td>
      <td>0.032533</td>
      <td>0.069075</td>
      <td>0.029166</td>
      <td>0.070898</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009</td>
      <td>8</td>
      <td>3</td>
      <td>137</td>
      <td>774.180446</td>
      <td>0.015675</td>
      <td>0.008147</td>
      <td>0.010947</td>
      <td>0.014206</td>
      <td>0.017549</td>
      <td>...</td>
      <td>0.048033</td>
      <td>0.085121</td>
      <td>0.065636</td>
      <td>0.043142</td>
      <td>0.082077</td>
      <td>0.020612</td>
      <td>0.032533</td>
      <td>0.069075</td>
      <td>0.029166</td>
      <td>0.070898</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2009</td>
      <td>9</td>
      <td>4</td>
      <td>70</td>
      <td>705.415222</td>
      <td>0.017605</td>
      <td>0.002329</td>
      <td>0.004775</td>
      <td>0.003472</td>
      <td>0.007965</td>
      <td>...</td>
      <td>0.094921</td>
      <td>0.047119</td>
      <td>0.046151</td>
      <td>0.045772</td>
      <td>0.041904</td>
      <td>0.025075</td>
      <td>0.068831</td>
      <td>0.057028</td>
      <td>0.019316</td>
      <td>0.073699</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2009</td>
      <td>10</td>
      <td>4</td>
      <td>10</td>
      <td>700.461168</td>
      <td>0.017605</td>
      <td>0.002329</td>
      <td>0.004775</td>
      <td>0.003472</td>
      <td>0.007965</td>
      <td>...</td>
      <td>0.094921</td>
      <td>0.047119</td>
      <td>0.046151</td>
      <td>0.045772</td>
      <td>0.041904</td>
      <td>0.025075</td>
      <td>0.068831</td>
      <td>0.057028</td>
      <td>0.019316</td>
      <td>0.073699</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2009</td>
      <td>11</td>
      <td>4</td>
      <td>630</td>
      <td>696.024702</td>
      <td>0.017605</td>
      <td>0.002329</td>
      <td>0.004775</td>
      <td>0.003472</td>
      <td>0.007965</td>
      <td>...</td>
      <td>0.094921</td>
      <td>0.047119</td>
      <td>0.046151</td>
      <td>0.045772</td>
      <td>0.041904</td>
      <td>0.025075</td>
      <td>0.068831</td>
      <td>0.057028</td>
      <td>0.019316</td>
      <td>0.073699</td>
    </tr>
  </tbody>
</table>
<p>5 rows  45 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="2242">
<div class="sourceCode" id="cb91"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>merged_df.columns</span></code></pre></div>
<div class="output execute_result" data-execution_count="2242">
<pre><code>Index([&#39;Year&#39;, &#39;Month&#39;, &#39;O_Season_Num&#39;, &#39;Actual&#39;, &#39;Predicted&#39;,
       &#39;prob_L10705000&#39;, &#39;prob_L10705100&#39;, &#39;prob_L10705200&#39;, &#39;prob_L10705300&#39;,
       &#39;prob_L10705400&#39;, &#39;prob_L10705500&#39;, &#39;prob_L10705600&#39;, &#39;prob_L10705700&#39;,
       &#39;prob_L10850600&#39;, &#39;prob_L10850700&#39;, &#39;prob_L10850800&#39;, &#39;prob_L10850900&#39;,
       &#39;prob_L10852800&#39;, &#39;prob_L10852900&#39;, &#39;prob_L10853100&#39;, &#39;prob_L12134400&#39;,
       &#39;prob_L12134500&#39;, &#39;prob_L12134600&#39;, &#39;prob_L12134700&#39;, &#39;prob_L12135800&#39;,
       &#39;prob_L12135900&#39;, &#39;prob_L12136000&#39;, &#39;prob_L12136100&#39;, &#39;prob_L12916800&#39;,
       &#39;prob_L12916900&#39;, &#39;prob_L12917000&#39;, &#39;prob_L12917100&#39;, &#39;prob_L12917700&#39;,
       &#39;prob_L12917800&#39;, &#39;prob_L12917900&#39;, &#39;prob_L12918000&#39;, &#39;prob_L12918400&#39;,
       &#39;prob_L12918500&#39;, &#39;prob_L12918600&#39;, &#39;prob_L12918700&#39;, &#39;prob_L12918800&#39;,
       &#39;prob_L12918900&#39;, &#39;prob_L12919000&#39;, &#39;prob_L12919100&#39;, &#39;prob_L12919200&#39;],
      dtype=&#39;object&#39;)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="2243">
<div class="sourceCode" id="cb93"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>prob_cols <span class="op">=</span> [<span class="st">&#39;prob_L10705000&#39;</span>, <span class="st">&#39;prob_L10705100&#39;</span>, <span class="st">&#39;prob_L10705200&#39;</span>, <span class="st">&#39;prob_L10705300&#39;</span>,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;prob_L10705400&#39;</span>, <span class="st">&#39;prob_L10705500&#39;</span>, <span class="st">&#39;prob_L10705600&#39;</span>, <span class="st">&#39;prob_L10705700&#39;</span>,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;prob_L10850600&#39;</span>, <span class="st">&#39;prob_L10850700&#39;</span>, <span class="st">&#39;prob_L10850800&#39;</span>, <span class="st">&#39;prob_L10850900&#39;</span>,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;prob_L10852800&#39;</span>, <span class="st">&#39;prob_L10852900&#39;</span>, <span class="st">&#39;prob_L10853100&#39;</span>, <span class="st">&#39;prob_L12134400&#39;</span>,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;prob_L12134500&#39;</span>, <span class="st">&#39;prob_L12134600&#39;</span>, <span class="st">&#39;prob_L12134700&#39;</span>, <span class="st">&#39;prob_L12135800&#39;</span>,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;prob_L12135900&#39;</span>, <span class="st">&#39;prob_L12136000&#39;</span>, <span class="st">&#39;prob_L12136100&#39;</span>, <span class="st">&#39;prob_L12916800&#39;</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;prob_L12916900&#39;</span>, <span class="st">&#39;prob_L12917000&#39;</span>, <span class="st">&#39;prob_L12917100&#39;</span>, <span class="st">&#39;prob_L12917700&#39;</span>,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;prob_L12917800&#39;</span>, <span class="st">&#39;prob_L12917900&#39;</span>, <span class="st">&#39;prob_L12918000&#39;</span>, <span class="st">&#39;prob_L12918400&#39;</span>,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;prob_L12918500&#39;</span>, <span class="st">&#39;prob_L12918600&#39;</span>, <span class="st">&#39;prob_L12918700&#39;</span>, <span class="st">&#39;prob_L12918800&#39;</span>,</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;prob_L12918900&#39;</span>, <span class="st">&#39;prob_L12919000&#39;</span>, <span class="st">&#39;prob_L12919100&#39;</span>, <span class="st">&#39;prob_L12919200&#39;</span>]</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>new_cols <span class="op">=</span> [col.split(<span class="st">&#39;_&#39;</span>)[<span class="dv">1</span>] <span class="cf">for</span> col <span class="kw">in</span> prob_cols]</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> prob_col, new_col <span class="kw">in</span> <span class="bu">zip</span>(prob_cols, new_cols):</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    merged_df[new_col] <span class="op">=</span> <span class="bu">round</span>(merged_df[prob_col] <span class="op">*</span> merged_df[<span class="st">&#39;Predicted&#39;</span>]).astype(<span class="bu">int</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2244">
<div class="sourceCode" id="cb94"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>merged_df.head(<span class="dv">10</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="2244">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Month</th>
      <th>O_Season_Num</th>
      <th>Actual</th>
      <th>Predicted</th>
      <th>prob_L10705000</th>
      <th>prob_L10705100</th>
      <th>prob_L10705200</th>
      <th>prob_L10705300</th>
      <th>prob_L10705400</th>
      <th>...</th>
      <th>L12918000</th>
      <th>L12918400</th>
      <th>L12918500</th>
      <th>L12918600</th>
      <th>L12918700</th>
      <th>L12918800</th>
      <th>L12918900</th>
      <th>L12919000</th>
      <th>L12919100</th>
      <th>L12919200</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2009</td>
      <td>7</td>
      <td>3</td>
      <td>1067</td>
      <td>695.285291</td>
      <td>0.015675</td>
      <td>0.008147</td>
      <td>0.010947</td>
      <td>0.014206</td>
      <td>0.017549</td>
      <td>...</td>
      <td>33</td>
      <td>59</td>
      <td>46</td>
      <td>30</td>
      <td>57</td>
      <td>14</td>
      <td>23</td>
      <td>48</td>
      <td>20</td>
      <td>49</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009</td>
      <td>8</td>
      <td>3</td>
      <td>137</td>
      <td>774.180446</td>
      <td>0.015675</td>
      <td>0.008147</td>
      <td>0.010947</td>
      <td>0.014206</td>
      <td>0.017549</td>
      <td>...</td>
      <td>37</td>
      <td>66</td>
      <td>51</td>
      <td>33</td>
      <td>64</td>
      <td>16</td>
      <td>25</td>
      <td>53</td>
      <td>23</td>
      <td>55</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2009</td>
      <td>9</td>
      <td>4</td>
      <td>70</td>
      <td>705.415222</td>
      <td>0.017605</td>
      <td>0.002329</td>
      <td>0.004775</td>
      <td>0.003472</td>
      <td>0.007965</td>
      <td>...</td>
      <td>67</td>
      <td>33</td>
      <td>33</td>
      <td>32</td>
      <td>30</td>
      <td>18</td>
      <td>49</td>
      <td>40</td>
      <td>14</td>
      <td>52</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2009</td>
      <td>10</td>
      <td>4</td>
      <td>10</td>
      <td>700.461168</td>
      <td>0.017605</td>
      <td>0.002329</td>
      <td>0.004775</td>
      <td>0.003472</td>
      <td>0.007965</td>
      <td>...</td>
      <td>66</td>
      <td>33</td>
      <td>32</td>
      <td>32</td>
      <td>29</td>
      <td>18</td>
      <td>48</td>
      <td>40</td>
      <td>14</td>
      <td>52</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2009</td>
      <td>11</td>
      <td>4</td>
      <td>630</td>
      <td>696.024702</td>
      <td>0.017605</td>
      <td>0.002329</td>
      <td>0.004775</td>
      <td>0.003472</td>
      <td>0.007965</td>
      <td>...</td>
      <td>66</td>
      <td>33</td>
      <td>32</td>
      <td>32</td>
      <td>29</td>
      <td>17</td>
      <td>48</td>
      <td>40</td>
      <td>13</td>
      <td>51</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2009</td>
      <td>12</td>
      <td>1</td>
      <td>361</td>
      <td>741.868185</td>
      <td>0.001506</td>
      <td>0.000912</td>
      <td>0.001122</td>
      <td>0.001520</td>
      <td>0.001606</td>
      <td>...</td>
      <td>0</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2010</td>
      <td>1</td>
      <td>1</td>
      <td>187</td>
      <td>721.978029</td>
      <td>0.001506</td>
      <td>0.000912</td>
      <td>0.001122</td>
      <td>0.001520</td>
      <td>0.001606</td>
      <td>...</td>
      <td>0</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2010</td>
      <td>2</td>
      <td>1</td>
      <td>370</td>
      <td>709.112277</td>
      <td>0.001506</td>
      <td>0.000912</td>
      <td>0.001122</td>
      <td>0.001520</td>
      <td>0.001606</td>
      <td>...</td>
      <td>0</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2010</td>
      <td>3</td>
      <td>2</td>
      <td>314</td>
      <td>722.643498</td>
      <td>0.000782</td>
      <td>0.000444</td>
      <td>0.000394</td>
      <td>0.000369</td>
      <td>0.001037</td>
      <td>...</td>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2010</td>
      <td>4</td>
      <td>2</td>
      <td>81</td>
      <td>718.502797</td>
      <td>0.000782</td>
      <td>0.000444</td>
      <td>0.000394</td>
      <td>0.000369</td>
      <td>0.001037</td>
      <td>...</td>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
<p>10 rows  85 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="2245">
<div class="sourceCode" id="cb95"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> monthly_df[[<span class="st">&#39;Previous_Month_Items&#39;</span>,<span class="st">&#39;Previous_Month_Urgent&#39;</span>, <span class="st">&#39;Previous_Month_Advanced_Urgent_Items&#39;</span>, <span class="st">&#39;Previous_Month_Advanced_Items&#39;</span>,<span class="st">&#39;Previous_Month_Total_Advanced&#39;</span>, <span class="st">&#39;Demand_Prv_Yr&#39;</span>, <span class="st">&#39;Total_Advanced_Prev_6_Months&#39;</span>]]</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> monthly_df[<span class="st">&#39;Demand&#39;</span>]</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Ridge()</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {<span class="st">&#39;alpha&#39;</span>: [<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>]}</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(model, parameters, scoring<span class="op">=</span><span class="st">&#39;neg_mean_squared_error&#39;</span>, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>grid_search.fit(X_train, y_train)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>best_alpha <span class="op">=</span> grid_search.best_params_[<span class="st">&#39;alpha&#39;</span>]</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Best alpha: </span><span class="sc">{</span>best_alpha<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Ridge(alpha<span class="op">=</span>best_alpha)</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> mean_absolute_error(y_test, y_pred)</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Mean Squared Error: </span><span class="sc">{</span>mse<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Mean Absolute Error: </span><span class="sc">{</span>mae<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>avg_actual <span class="op">=</span> y.mean()</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>mae_ratio <span class="op">=</span> mae <span class="op">/</span> avg_actual</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MAE Ratio: </span><span class="sc">{</span>mae_ratio<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X)</span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> pd.DataFrame({<span class="st">&#39;Year&#39;</span>: monthly_df[<span class="st">&#39;Order Year&#39;</span>], <span class="st">&#39;Month&#39;</span>: monthly_df[<span class="st">&#39;Order Month&#39;</span>], <span class="st">&#39;O_Season_Num&#39;</span>: monthly_df[<span class="st">&#39;O_Season_Num&#39;</span>], <span class="st">&#39;Actual&#39;</span>: y, <span class="st">&#39;Predicted&#39;</span>: y_pred})</span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(predictions)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best alpha: 100
Mean Squared Error: 255786.3373
Mean Absolute Error: 485.5055
MAE Ratio: 0.7376
    Year  Month  O_Season_Num  Actual    Predicted
0   2009      7             3    1067   689.534588
1   2009      8             3     137   555.525953
2   2009      9             4      70   672.328231
3   2009     10             4      10   680.743019
4   2009     11             4     630   688.278650
5   2009     12             1     361   610.410464
6   2010      1             1     187   847.352888
7   2010      2             1     370   692.133452
8   2010      3             2     314   656.392922
9   2010      4             2      81   652.002128
10  2010      5             2       7   799.314006
11  2010      6             3       3   757.390129
12  2010     12             1     705   357.418972
13  2011      1             1    1750   624.273252
14  2011      2             1     871   505.431808
15  2011      3             2     270   592.122042
16  2011      4             2      47   440.062410
17  2011      5             2      14   559.918805
18  2011      6             3      45   757.629016
19  2011      7             3    6616   889.701737
20  2011      8             3    2408  2416.285083
21  2011      9             4     983   907.361372
22  2011     10             4      62   378.924331
23  2011     11             4      57   683.380550
24  2012      1             1      42   516.719937
25  2012      4             2       7  1341.466369
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Let's make a prediciton for next months demand.</p>
</div>
<div class="cell code" data-execution_count="2246">
<div class="sourceCode" id="cb97"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> monthly_df[[<span class="st">&#39;Previous_Month_Items&#39;</span>, <span class="st">&#39;Previous_Month_Urgent&#39;</span>, <span class="st">&#39;Previous_Month_Advanced_Urgent_Items&#39;</span>, <span class="st">&#39;Previous_Month_Advanced_Items&#39;</span>, <span class="st">&#39;Previous_Month_Total_Advanced&#39;</span>, <span class="st">&#39;Demand_Prv_Yr&#39;</span>, <span class="st">&#39;Total_Advanced_Prev_6_Months&#39;</span>]]</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> monthly_df[<span class="st">&#39;Demand&#39;</span>]</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Ridge(alpha<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> pd.DataFrame({<span class="st">&#39;Previous_Month_Items&#39;</span>: [monthly_df[<span class="st">&#39;Previous_Month_Items&#39;</span>].iloc[<span class="op">-</span><span class="dv">1</span>]], </span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;Previous_Month_Urgent&#39;</span>: [monthly_df[<span class="st">&#39;Previous_Month_Urgent&#39;</span>].iloc[<span class="op">-</span><span class="dv">1</span>]], </span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;Previous_Month_Advanced_Urgent_Items&#39;</span>: [monthly_df[<span class="st">&#39;Previous_Month_Advanced_Urgent_Items&#39;</span>].iloc[<span class="op">-</span><span class="dv">1</span>]],</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;Previous_Month_Advanced_Items&#39;</span>: [monthly_df[<span class="st">&#39;Previous_Month_Advanced_Items&#39;</span>].iloc[<span class="op">-</span><span class="dv">1</span>]],</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;Previous_Month_Total_Advanced&#39;</span>: [monthly_df[<span class="st">&#39;Previous_Month_Total_Advanced&#39;</span>].iloc[<span class="op">-</span><span class="dv">1</span>]],</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;Demand_Prv_Yr&#39;</span>: [monthly_df[<span class="st">&#39;Demand_Prv_Yr&#39;</span>].iloc[<span class="op">-</span><span class="dv">1</span>]],</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;Total_Advanced_Prev_6_Months&#39;</span>: [monthly_df[<span class="st">&#39;Total_Advanced_Prev_6_Months&#39;</span>].iloc[<span class="op">-</span><span class="dv">1</span>]]})</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>prediction <span class="op">=</span> model.predict(new_data)</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Predicted demand for the next month: </span><span class="sc">{</span>prediction[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Predicted demand for the next month: 1333.83
</code></pre>
</div>
</div>
</body>
</html>
